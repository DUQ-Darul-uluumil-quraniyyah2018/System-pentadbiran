<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pentadbiran Mahad Tahfiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .custom-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* Device-specific responsive styles */
        .device-mobile {
            font-size: 14px;
        }
        .device-mobile .container {
            padding: 8px;
        }
        .device-mobile .nav-btn {
            padding: 8px 12px;
            font-size: 12px;
        }
        .device-mobile .form-grid {
            grid-template-columns: 1fr;
        }
        .device-mobile .table-container {
            font-size: 12px;
        }
        
        .device-tablet {
            font-size: 15px;
        }
        .device-tablet .container {
            padding: 12px;
        }
        .device-tablet .nav-btn {
            padding: 10px 16px;
            font-size: 13px;
        }
        .device-tablet .form-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .device-laptop {
            font-size: 16px;
        }
        .device-laptop .container {
            padding: 16px;
        }
        .device-laptop .nav-btn {
            padding: 12px 20px;
            font-size: 14px;
        }
        .device-laptop .form-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .device-desktop {
            font-size: 18px;
        }
        .device-desktop .container {
            padding: 20px;
        }
        .device-desktop .nav-btn {
            padding: 14px 24px;
            font-size: 16px;
        }
        .device-desktop .form-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        
        /* Screen size indicator */
        .screen-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .screen-indicator.hidden {
            opacity: 0;
            transform: translateY(20px);
        }
        
        /* Custom wallpaper styles */
        .custom-wallpaper {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .wallpaper-overlay {
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Logo preview styles */
        .logo-preview {
            max-width: 100px;
            max-height: 100px;
            object-fit: contain;
            border: 2px dashed #ccc;
            padding: 10px;
            border-radius: 8px;
        }
        
        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-area, .print-area * {
                visibility: visible;
            }
            
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white !important;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 2px solid #000;
                padding-bottom: 20px;
            }
            
            .print-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }
            
            .print-table th,
            .print-table td {
                border: 1px solid #000;
                padding: 8px;
                text-align: left;
                font-size: 12px;
            }
            
            .print-table th {
                background-color: #f0f0f0 !important;
                font-weight: bold;
            }
            
            .print-footer {
                margin-top: 30px;
                text-align: right;
                font-size: 12px;
            }
            
            .page-break {
                page-break-before: always;
            }
        }
    </style>
</head>
<body class="min-h-screen custom-bg">
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <!-- Screen Size Indicator -->
    <div id="screen-indicator" class="screen-indicator">
        <span id="device-type">üñ•Ô∏è Desktop</span> | 
        <span id="screen-size">1920x1080</span>
    </div>

    <!-- Password Recovery Modal -->
    <div id="password-recovery-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Pemulihan Kata Laluan</h3>
                    <button id="close-recovery-modal" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Step 1: Username -->
                <div id="recovery-step-1" class="recovery-step">
                    <h4 class="text-md font-medium text-gray-800 mb-3">Langkah 1: Pengesahan Identiti</h4>
                    <div class="mb-4">
                        <label for="recovery-username" class="block text-sm font-medium text-gray-700 mb-2">Nama Pengguna</label>
                        <input type="text" id="recovery-username" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button id="verify-username" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                        Seterusnya
                    </button>
                </div>
                
                <!-- Step 2: Security Questions -->
                <div id="recovery-step-2" class="recovery-step hidden">
                    <h4 class="text-md font-medium text-gray-800 mb-3">Langkah 2: Soalan Keselamatan</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Apakah nama sekolah rendah pertama anda?</label>
                            <input type="text" id="security-answer-1" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Apakah nama ibu anda?</label>
                            <input type="text" id="security-answer-2" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Apakah bandar kelahiran anda?</label>
                            <input type="text" id="security-answer-3" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex space-x-3 mt-4">
                        <button id="back-to-step-1" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Kembali
                        </button>
                        <button id="verify-security" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                            Sahkan
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: New Password -->
                <div id="recovery-step-3" class="recovery-step hidden">
                    <h4 class="text-md font-medium text-gray-800 mb-3">Langkah 3: Kata Laluan Baru</h4>
                    <div class="space-y-4">
                        <div>
                            <label for="new-recovery-password" class="block text-sm font-medium text-gray-700 mb-2">Kata Laluan Baru</label>
                            <input type="password" id="new-recovery-password" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="confirm-recovery-password" class="block text-sm font-medium text-gray-700 mb-2">Sahkan Kata Laluan</label>
                            <input type="password" id="confirm-recovery-password" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="flex space-x-3 mt-4">
                        <button id="back-to-step-2" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Kembali
                        </button>
                        <button id="reset-password" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition duration-200">
                            Reset Kata Laluan
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Success -->
                <div id="recovery-step-4" class="recovery-step hidden">
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                        <h4 class="text-lg font-medium text-gray-900 mb-2">Berjaya!</h4>
                        <p class="text-sm text-gray-600 mb-4">Kata laluan anda telah berjaya dikemaskini. Anda boleh log masuk dengan kata laluan baru.</p>
                        <button id="close-recovery-success" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div id="logo-container" class="mb-4">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-blue-500 rounded-full mx-auto flex items-center justify-center">
                        <span class="text-white text-2xl font-bold">MT</span>
                    </div>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Sistem Pentadbiran</h1>
                <p class="text-gray-600">Mahad Tahfiz Al-Quran</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Nama Pengguna</label>
                    <input type="text" id="username" name="username" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Kata Laluan</label>
                    <input type="password" id="password" name="password" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                    Log Masuk
                </button>
                
                <div class="text-center">
                    <button type="button" id="forgot-password" class="text-blue-600 hover:text-blue-800 text-sm">
                        Lupa Kata Laluan?
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Print Area (Hidden) -->
    <div id="print-area" class="print-area hidden">
        <!-- Print content will be dynamically inserted here -->
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <div id="dashboard-logo" class="w-10 h-10 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold">MT</span>
                    </div>
                    <h1 class="text-xl font-semibold text-gray-800">Sistem Pentadbiran Mahad Tahfiz Al-Quran</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Update Notifications -->
                    <div class="relative">
                        <button id="updates-btn" class="relative bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition duration-200 flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h6v-7a1 1 0 011-1h4a1 1 0 011 1v7h6M4 10l8-6 8 6v9a1 1 0 01-1 1H5a1 1 0 01-1-1v-9z"></path>
                            </svg>
                            <span>Kemaskini</span>
                            <span id="updates-badge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center">0</span>
                        </button>
                        
                        <!-- Updates Dropdown -->
                        <div id="updates-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border z-50">
                            <div class="p-4 border-b">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-semibold text-gray-800">Kemaskini Sistem</h3>
                                    <div class="flex space-x-2">
                                        <button id="mark-all-read" class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded hover:bg-blue-200 transition duration-200">
                                            Tandai Semua Dibaca
                                        </button>
                                        <button id="clear-all-updates" class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded hover:bg-red-200 transition duration-200">
                                            Padam Semua
                                        </button>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                                    <span id="total-updates-count">0 kemaskini</span>
                                    <span id="unread-updates-count">0 belum dibaca</span>
                                </div>
                            </div>
                            
                            <div id="updates-list" class="max-h-80 overflow-y-auto">
                                <div class="p-4 text-center text-gray-500 text-sm">
                                    Tiada kemaskini baharu
                                </div>
                            </div>
                            
                            <div class="p-3 border-t bg-gray-50">
                                <div class="flex items-center justify-between text-xs text-gray-600">
                                    <span>Kemaskini automatik: <span id="auto-update-status">Aktif</span></span>
                                    <button id="toggle-auto-updates" class="text-blue-600 hover:text-blue-800">
                                        Tetapan
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-right">
                        <div id="current-user" class="text-gray-800 font-medium">Admin</div>
                        <div id="current-user-role" class="text-xs text-gray-500">Admin</div>
                    </div>
                    <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition duration-200">
                        Log Keluar
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-gray-800 text-white">
            <div class="px-6 py-4">
                <div class="flex space-x-8 overflow-x-auto">
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md bg-gray-700" data-section="hafazan">Rekod Hafazan</button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="prestasi">Prestasi Harian</button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="disiplin">Rekod Disiplin</button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="pencapaian">Pengiktirafan</button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="aktiviti">Aktiviti Pelajar</button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="pelajar">
                        Data Pelajar 
                        <span class="ml-1 text-xs bg-red-500 text-white px-1 rounded">üîí</span>
                    </button>
                    <button class="nav-btn whitespace-nowrap px-3 py-2 rounded-md hover:bg-gray-700" data-section="tetapan">
                        Tetapan 
                        <span class="ml-1 text-xs bg-red-500 text-white px-1 rounded">üîí</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="container p-6">
            <!-- Rekod Hafazan Section -->
            <div id="hafazan-section" class="section">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Rekod Hafazan Harian Pelajar</h2>
                    
                    <!-- Auto Prestasi Info -->
                    <div class="mb-6 bg-blue-50 border-l-4 border-blue-400 p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Automasi Prestasi:</strong> Rekod prestasi harian akan dibuat secara automatik berdasarkan data hafazan yang dimasukkan. 
                                    <br><strong>Pemetaan Keputusan:</strong> Lancar‚ÜíCemerlang | Kurang Lancar‚ÜíBaik | Tidak Lancar‚ÜíMemuaskan | Tidak Sampai Target‚ÜíSederhana | Gagal/Mengulang‚ÜíLemah
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="hafazan-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="nama-pelajar" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelajar</label>
                            <input type="text" id="nama-pelajar" name="nama-pelajar" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="no-kad-pelajar" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="no-kad-pelajar" name="no-kad-pelajar" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="kelas" class="block text-sm font-medium text-gray-700 mb-2">Pilihan Nama Kelas</label>
                            <select id="kelas" name="kelas" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Kelas</option>
                                <option value="mumtaz">Mumtaz</option>
                                <option value="jayyid">Jayyid</option>
                                <option value="maqbul">Maqbul</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="jenis-hafalan" class="block text-sm font-medium text-gray-700 mb-2">Pilihan Jenis Hafalan/Bacaan</label>
                            <select id="jenis-hafalan" name="jenis-hafalan" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Jenis</option>
                                <option value="naziroh">Naziroh</option>
                                <option value="sabaq">Sabaq</option>
                                <option value="sabqi">Sabqi</option>
                                <option value="manzil">Manzil</option>
                                <option value="sabaq-ulang">Sabaq Ulang</option>
                                <option value="juzuk-khatam">Juzuk Khatam</option>
                                <option value="ulangan-syahadah">Ulangan Syahadah</option>
                            </select>
                        </div>
                        
                        <!-- Dynamic Fields for Sabaq -->
                        <div id="sabaq-fields" class="hidden md:col-span-2 lg:col-span-3">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-md font-semibold text-blue-800 mb-3">üìñ Maklumat Sabaq</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="sabaq-bilangan-baris" class="block text-sm font-medium text-gray-700 mb-2">Bilangan Baris</label>
                                        <input type="number" id="sabaq-bilangan-baris" name="sabaq-bilangan-baris" min="1" max="50"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dynamic Fields for Sabqi/Manzil -->
                        <div id="sabqi-manzil-fields" class="hidden md:col-span-2 lg:col-span-3">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-md font-semibold text-green-800 mb-3">üìö Maklumat Sabqi/Manzil</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="sabqi-sebelum" class="block text-sm font-medium text-gray-700 mb-2">1. Sabqi/Sebelum</label>
                                        <input type="text" id="sabqi-sebelum" name="sabqi-sebelum"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="sabqi-akan-datang" class="block text-sm font-medium text-gray-700 mb-2">2. Sabqi/Manzil Akan Datang</label>
                                        <input type="text" id="sabqi-akan-datang" name="sabqi-akan-datang"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="ayat-awal" class="block text-sm font-medium text-gray-700 mb-2">Ayat Awal</label>
                                        <input type="text" id="ayat-awal" name="ayat-awal"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="ayat-akhir" class="block text-sm font-medium text-gray-700 mb-2">Ayat Akhir</label>
                                        <input type="text" id="ayat-akhir" name="ayat-akhir"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="sasaran-baris-juzuk" class="block text-sm font-medium text-gray-700 mb-2">Sasaran Baris/Juzuk</label>
                                        <input type="text" id="sasaran-baris-juzuk" name="sasaran-baris-juzuk"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label for="pilihan-juzuk-muka" class="block text-sm font-medium text-gray-700 mb-2">Pilihan Juzuk atau Muka Surah</label>
                                        <select id="pilihan-juzuk-muka" name="pilihan-juzuk-muka"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Pilih</option>
                                            <option value="juzuk">Juzuk</option>
                                            <option value="muka-surah">Muka Surah</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label for="surah" class="block text-sm font-medium text-gray-700 mb-2">Surah</label>
                            <select id="surah" name="surah" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Surah</option>
                                <option value="al-baqarah">Al-Baqarah</option>
                                <option value="ali-imran">Ali Imran</option>
                                <option value="an-nisa">An-Nisa</option>
                                <option value="al-maidah">Al-Maidah</option>
                                <option value="al-anam">Al-An'am</option>
                                <option value="al-araf">Al-A'raf</option>
                                <option value="al-anfal">Al-Anfal</option>
                                <option value="at-taubah">At-Taubah</option>
                                <option value="yunus">Yunus</option>
                                <option value="hud">Hud</option>
                                <option value="yusuf">Yusuf</option>
                                <option value="ar-rad">Ar-Ra'd</option>
                                <option value="ibrahim">Ibrahim</option>
                                <option value="al-hijr">Al-Hijr</option>
                                <option value="an-nahl">An-Nahl</option>
                                <option value="al-isra">Al-Isra</option>
                                <option value="al-kahf">Al-Kahf</option>
                                <option value="maryam">Maryam</option>
                                <option value="taha">Taha</option>
                                <option value="al-anbiya">Al-Anbiya</option>
                                <option value="al-hajj">Al-Hajj</option>
                                <option value="al-muminun">Al-Mu'minun</option>
                                <option value="an-nur">An-Nur</option>
                                <option value="al-furqan">Al-Furqan</option>
                                <option value="ash-shuara">Ash-Shu'ara</option>
                                <option value="an-naml">An-Naml</option>
                                <option value="al-qasas">Al-Qasas</option>
                                <option value="al-ankabut">Al-Ankabut</option>
                                <option value="ar-rum">Ar-Rum</option>
                                <option value="luqman">Luqman</option>
                                <option value="as-sajdah">As-Sajdah</option>
                                <option value="al-ahzab">Al-Ahzab</option>
                                <option value="saba">Saba</option>
                                <option value="fatir">Fatir</option>
                                <option value="yasin">Yasin</option>
                                <option value="as-saffat">As-Saffat</option>
                                <option value="sad">Sad</option>
                                <option value="az-zumar">Az-Zumar</option>
                                <option value="ghafir">Ghafir</option>
                                <option value="fussilat">Fussilat</option>
                                <option value="ash-shura">Ash-Shura</option>
                                <option value="az-zukhruf">Az-Zukhruf</option>
                                <option value="ad-dukhan">Ad-Dukhan</option>
                                <option value="al-jathiyah">Al-Jathiyah</option>
                                <option value="al-ahqaf">Al-Ahqaf</option>
                                <option value="muhammad">Muhammad</option>
                                <option value="al-fath">Al-Fath</option>
                                <option value="al-hujurat">Al-Hujurat</option>
                                <option value="qaf">Qaf</option>
                                <option value="adh-dhariyat">Adh-Dhariyat</option>
                                <option value="at-tur">At-Tur</option>
                                <option value="an-najm">An-Najm</option>
                                <option value="al-qamar">Al-Qamar</option>
                                <option value="ar-rahman">Ar-Rahman</option>
                                <option value="al-waqiah">Al-Waqi'ah</option>
                                <option value="al-hadid">Al-Hadid</option>
                                <option value="al-mujadilah">Al-Mujadilah</option>
                                <option value="al-hashr">Al-Hashr</option>
                                <option value="al-mumtahanah">Al-Mumtahanah</option>
                                <option value="as-saff">As-Saff</option>
                                <option value="al-jumuah">Al-Jumu'ah</option>
                                <option value="al-munafiqun">Al-Munafiqun</option>
                                <option value="at-taghabun">At-Taghabun</option>
                                <option value="at-talaq">At-Talaq</option>
                                <option value="at-tahrim">At-Tahrim</option>
                                <option value="al-mulk">Al-Mulk</option>
                                <option value="al-qalam">Al-Qalam</option>
                                <option value="al-haqqah">Al-Haqqah</option>
                                <option value="al-maarij">Al-Ma'arij</option>
                                <option value="nuh">Nuh</option>
                                <option value="al-jinn">Al-Jinn</option>
                                <option value="al-muzzammil">Al-Muzzammil</option>
                                <option value="al-muddaththir">Al-Muddaththir</option>
                                <option value="al-qiyamah">Al-Qiyamah</option>
                                <option value="al-insan">Al-Insan</option>
                                <option value="al-mursalat">Al-Mursalat</option>
                                <option value="an-naba">An-Naba</option>
                                <option value="an-naziat">An-Nazi'at</option>
                                <option value="abasa">Abasa</option>
                                <option value="at-takwir">At-Takwir</option>
                                <option value="al-infitar">Al-Infitar</option>
                                <option value="al-mutaffifin">Al-Mutaffifin</option>
                                <option value="al-inshiqaq">Al-Inshiqaq</option>
                                <option value="al-buruj">Al-Buruj</option>
                                <option value="at-tariq">At-Tariq</option>
                                <option value="al-ala">Al-A'la</option>
                                <option value="al-ghashiyah">Al-Ghashiyah</option>
                                <option value="al-fajr">Al-Fajr</option>
                                <option value="al-balad">Al-Balad</option>
                                <option value="ash-shams">Ash-Shams</option>
                                <option value="al-layl">Al-Layl</option>
                                <option value="ad-duha">Ad-Duha</option>
                                <option value="ash-sharh">Ash-Sharh</option>
                                <option value="at-tin">At-Tin</option>
                                <option value="al-alaq">Al-Alaq</option>
                                <option value="al-qadr">Al-Qadr</option>
                                <option value="al-bayyinah">Al-Bayyinah</option>
                                <option value="az-zalzalah">Az-Zalzalah</option>
                                <option value="al-adiyat">Al-Adiyat</option>
                                <option value="al-qariah">Al-Qari'ah</option>
                                <option value="at-takathur">At-Takathur</option>
                                <option value="al-asr">Al-Asr</option>
                                <option value="al-humazah">Al-Humazah</option>
                                <option value="al-fil">Al-Fil</option>
                                <option value="quraysh">Quraysh</option>
                                <option value="al-maun">Al-Ma'un</option>
                                <option value="al-kawthar">Al-Kawthar</option>
                                <option value="al-kafirun">Al-Kafirun</option>
                                <option value="an-nasr">An-Nasr</option>
                                <option value="al-masad">Al-Masad</option>
                                <option value="al-ikhlas">Al-Ikhlas</option>
                                <option value="al-falaq">Al-Falaq</option>
                                <option value="an-nas">An-Nas</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="keputusan" class="block text-sm font-medium text-gray-700 mb-2">Keputusan</label>
                            <select id="keputusan" name="keputusan" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Keputusan</option>
                                <option value="lancar">Lancar</option>
                                <option value="kurang-lancar">Kurang Lancar</option>
                                <option value="tidak-lancar">Tidak Lancar</option>
                                <option value="tidak-sampai-target">Tidak Sampai Target</option>
                                <option value="gagal">Gagal</option>
                                <option value="mengulang">Mengulang</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="kehadiran" class="block text-sm font-medium text-gray-700 mb-2">Pilihan Kehadiran</label>
                            <select id="kehadiran" name="kehadiran" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Kehadiran</option>
                                <option value="hadir">Hadir Dalam Kelas</option>
                                <option value="cuti">Cuti</option>
                                <option value="sakit">Sakit</option>
                                <option value="ponteng">Ponteng Kelas</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="ustaz-tasmik" class="block text-sm font-medium text-gray-700 mb-2">Nama Ustaz Tasmik</label>
                            <input type="text" id="ustaz-tasmik" name="ustaz-tasmik" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <label for="catatan-ustaz" class="block text-sm font-medium text-gray-700 mb-2">Catatan Ustaz</label>
                            <textarea id="catatan-ustaz" name="catatan-ustaz" rows="3" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Catatan tambahan dari ustaz tasmik..."></textarea>
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                Simpan Rekod Hafazan
                            </button>
                        </div>
                    </form>
                    
                    <!-- Hafazan Records Table -->
                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Rekod Hafazan Terkini</h3>
                            <div class="space-x-2">
                                <button id="print-hafazan" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                    üñ®Ô∏è Cetak Laporan
                                </button>
                                <button id="export-hafazan" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                    üìä Export Excel
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Pelajar</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kelas</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jenis Hafalan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Surah</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Keputusan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ustaz</th>
                                    </tr>
                                </thead>
                                <tbody id="hafazan-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prestasi Harian Section -->
            <div id="prestasi-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Prestasi Harian Pelajar</h2>
                    
                    <div class="mb-6 bg-green-50 border-l-4 border-green-400 p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-green-700">
                                    <strong>Rekod Automatik:</strong> Prestasi harian dibuat secara automatik berdasarkan rekod hafazan. Anda juga boleh menambah rekod manual di sini.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="prestasi-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="prestasi-nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelajar</label>
                            <input type="text" id="prestasi-nama" name="prestasi-nama" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="prestasi-no-kad" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="prestasi-no-kad" name="prestasi-no-kad" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="prestasi-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tarikh</label>
                            <input type="date" id="prestasi-tarikh" name="prestasi-tarikh" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="prestasi-hari" class="block text-sm font-medium text-gray-700 mb-2">Hari</label>
                            <select id="prestasi-hari" name="prestasi-hari" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Hari</option>
                                <option value="Isnin">Isnin</option>
                                <option value="Selasa">Selasa</option>
                                <option value="Rabu">Rabu</option>
                                <option value="Khamis">Khamis</option>
                                <option value="Jumaat">Jumaat</option>
                                <option value="Sabtu">Sabtu</option>
                                <option value="Ahad">Ahad</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="prestasi-surah" class="block text-sm font-medium text-gray-700 mb-2">Surah/Aktiviti</label>
                            <input type="text" id="prestasi-surah" name="prestasi-surah" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="prestasi-keputusan" class="block text-sm font-medium text-gray-700 mb-2">Prestasi</label>
                            <select id="prestasi-keputusan" name="prestasi-keputusan" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Prestasi</option>
                                <option value="cemerlang">Cemerlang</option>
                                <option value="baik">Baik</option>
                                <option value="memuaskan">Memuaskan</option>
                                <option value="sederhana">Sederhana</option>
                                <option value="lemah">Lemah</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="prestasi-catatan" class="block text-sm font-medium text-gray-700 mb-2">Catatan</label>
                            <input type="text" id="prestasi-catatan" name="prestasi-catatan" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                Simpan Prestasi
                            </button>
                        </div>
                    </form>
                    
                    <!-- Prestasi Records Table -->
                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Rekod Prestasi Terkini</h3>
                            <div class="space-x-2">
                                <button id="print-prestasi" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                    üñ®Ô∏è Cetak Laporan
                                </button>
                                <button id="export-prestasi" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                    üìä Export Excel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Search and Filter for Prestasi -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="text-md font-semibold text-gray-800 mb-3">üîç Carian dan Penapisan Prestasi</h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label for="search-prestasi" class="block text-sm font-medium text-gray-700 mb-2">Cari Nama Pelajar</label>
                                    <input type="text" id="search-prestasi" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           placeholder="Masukkan nama pelajar...">
                                </div>
                                <div>
                                    <label for="filter-prestasi-keputusan" class="block text-sm font-medium text-gray-700 mb-2">Tapis Prestasi</label>
                                    <select id="filter-prestasi-keputusan" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Semua Prestasi</option>
                                        <option value="cemerlang">Cemerlang</option>
                                        <option value="baik">Baik</option>
                                        <option value="memuaskan">Memuaskan</option>
                                        <option value="sederhana">Sederhana</option>
                                        <option value="lemah">Lemah</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="filter-prestasi-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tapis Tarikh</label>
                                    <input type="date" id="filter-prestasi-tarikh" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="flex items-end space-x-2">
                                    <button id="apply-prestasi-filter" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                        Tapis
                                    </button>
                                    <button id="reset-prestasi-filter" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Hari</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Pelajar</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Surah/Aktiviti</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Prestasi</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Catatan</th>
                                    </tr>
                                </thead>
                                <tbody id="prestasi-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rekod Disiplin Section -->
            <div id="disiplin-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Rekod Disiplin Pelajar</h2>
                    
                    <form id="disiplin-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="disiplin-nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelajar</label>
                            <input type="text" id="disiplin-nama" name="disiplin-nama" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="disiplin-no-kad" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="disiplin-no-kad" name="disiplin-no-kad" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="disiplin-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tarikh</label>
                            <input type="date" id="disiplin-tarikh" name="disiplin-tarikh" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <label for="disiplin-laporan-guru" class="block text-sm font-medium text-gray-700 mb-2">Laporan Guru</label>
                            <textarea id="disiplin-laporan-guru" name="disiplin-laporan-guru" rows="3" required 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Laporan lengkap dari guru mengenai insiden..."></textarea>
                        </div>
                        
                        <div>
                            <label for="disiplin-kesalahan-kecil" class="block text-sm font-medium text-gray-700 mb-2">Kesalahan Kecil</label>
                            <select id="disiplin-kesalahan-kecil" name="disiplin-kesalahan-kecil" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih (jika berkaitan)</option>
                                <option value="lewat-masuk">Lewat Masuk Kelas</option>
                                <option value="tidak-siap-tugasan">Tidak Siap Tugasan</option>
                                <option value="bising-kelas">Bising Dalam Kelas</option>
                                <option value="pakaian-tidak-kemas">Pakaian Tidak Kemas</option>
                                <option value="tidak-bawa-buku">Tidak Bawa Buku</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="disiplin-kesalahan-sederhana" class="block text-sm font-medium text-gray-700 mb-2">Kesalahan Sederhana</label>
                            <select id="disiplin-kesalahan-sederhana" name="disiplin-kesalahan-sederhana" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih (jika berkaitan)</option>
                                <option value="ponteng-kelas">Ponteng Kelas</option>
                                <option value="tidak-hormat-guru">Tidak Hormat Guru</option>
                                <option value="bergaduh-ringan">Bergaduh Ringan</option>
                                <option value="keluar-tanpa-kebenaran">Keluar Tanpa Kebenaran</option>
                                <option value="tidak-solat-berjemaah">Tidak Solat Berjemaah</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="disiplin-kesalahan-besar" class="block text-sm font-medium text-gray-700 mb-2">Kesalahan Besar</label>
                            <select id="disiplin-kesalahan-besar" name="disiplin-kesalahan-besar" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih (jika berkaitan)</option>
                                <option value="bergaduh-serius">Bergaduh Serius</option>
                                <option value="mencuri">Mencuri</option>
                                <option value="merokok">Merokok</option>
                                <option value="buli">Membuli Pelajar Lain</option>
                                <option value="rosak-harta">Merosakkan Harta Sekolah</option>
                                <option value="keluar-sekolah">Keluar Sekolah Tanpa Kebenaran</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="disiplin-tindakan-guru" class="block text-sm font-medium text-gray-700 mb-2">Tindakan Guru/Guru Disiplin/Mudir</label>
                            <select id="disiplin-tindakan-guru" name="disiplin-tindakan-guru" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Tindakan</option>
                                <option value="nasihat-lisan">Nasihat Lisan</option>
                                <option value="teguran-bertulis">Teguran Bertulis</option>
                                <option value="panggil-ibu-bapa">Panggil Ibu Bapa</option>
                                <option value="kerja-khidmat-masyarakat">Kerja Khidmat Masyarakat</option>
                                <option value="gantung-aktiviti">Gantung Dari Aktiviti</option>
                                <option value="rujuk-kaunselor">Rujuk Kaunselor</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="disiplin-tindakan-sekolah" class="block text-sm font-medium text-gray-700 mb-2">Pilihan Tindakan Sekolah</label>
                            <select id="disiplin-tindakan-sekolah" name="disiplin-tindakan-sekolah" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Tindakan</option>
                                <option value="amaran-rasmi">Amaran Rasmi</option>
                                <option value="denda-wang">Denda Wang</option>
                                <option value="gantung-1-hari">Gantung 1 Hari</option>
                                <option value="gantung-3-hari">Gantung 3 Hari</option>
                                <option value="gantung-1-minggu">Gantung 1 Minggu</option>
                                <option value="buang-sekolah">Buang Sekolah</option>
                                <option value="lapor-polis">Lapor Polis</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="disiplin-guru" class="block text-sm font-medium text-gray-700 mb-2">Guru Bertugas</label>
                            <input type="text" id="disiplin-guru" name="disiplin-guru" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition duration-200">
                                Simpan Rekod Disiplin
                            </button>
                        </div>
                    </form>
                    
                    <!-- Disiplin Records Table -->
                    <div class="mt-8">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Rekod Disiplin Terkini</h3>
                            <div class="space-x-2">
                                <button id="print-disiplin" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                    üñ®Ô∏è Cetak Laporan
                                </button>
                                <button id="export-disiplin" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                    üìä Export Excel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Search and Filter for Disiplin -->
                        <div class="bg-gray-50 p-4 rounded-lg mb-4">
                            <h4 class="text-md font-semibold text-gray-800 mb-3">üîç Carian dan Penapisan Disiplin</h4>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label for="search-disiplin" class="block text-sm font-medium text-gray-700 mb-2">Cari Nama Pelajar</label>
                                    <input type="text" id="search-disiplin" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           placeholder="Masukkan nama pelajar...">
                                </div>
                                <div>
                                    <label for="filter-disiplin-jenis" class="block text-sm font-medium text-gray-700 mb-2">Tapis Jenis Kesalahan</label>
                                    <select id="filter-disiplin-jenis" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Semua Jenis</option>
                                        <option value="kesalahan-kecil">Kesalahan Kecil</option>
                                        <option value="kesalahan-sederhana">Kesalahan Sederhana</option>
                                        <option value="kesalahan-besar">Kesalahan Besar</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="filter-disiplin-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tapis Tarikh</label>
                                    <input type="date" id="filter-disiplin-tarikh" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="flex items-end space-x-2">
                                    <button id="apply-disiplin-filter" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200">
                                        Tapis
                                    </button>
                                    <button id="reset-disiplin-filter" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Pelajar</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jenis Kes</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Keterangan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tindakan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Guru</th>
                                    </tr>
                                </thead>
                                <tbody id="disiplin-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pengiktirafan Section -->
            <div id="pencapaian-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Pengiktirafan & Pencapaian</h2>
                    
                    <form id="pencapaian-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="pencapaian-nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelajar</label>
                            <input type="text" id="pencapaian-nama" name="pencapaian-nama" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pencapaian-no-kad" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="pencapaian-no-kad" name="pencapaian-no-kad" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="pencapaian-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tarikh</label>
                            <input type="date" id="pencapaian-tarikh" name="pencapaian-tarikh" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pencapaian-jenis" class="block text-sm font-medium text-gray-700 mb-2">Jenis Pengiktirafan</label>
                            <select id="pencapaian-jenis" name="pencapaian-jenis" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Jenis</option>
                                <option value="khatam-quran">Khatam Al-Quran</option>
                                <option value="hafiz-30-juzuk">Hafiz 30 Juzuk</option>
                                <option value="hafiz-20-juzuk">Hafiz 20 Juzuk</option>
                                <option value="hafiz-10-juzuk">Hafiz 10 Juzuk</option>
                                <option value="hafiz-5-juzuk">Hafiz 5 Juzuk</option>
                                <option value="pelajar-terbaik">Pelajar Terbaik</option>
                                <option value="kehadiran-sempurna">Kehadiran Sempurna</option>
                                <option value="akhlak-terpuji">Akhlak Terpuji</option>
                                <option value="pertandingan">Pertandingan</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <label for="pencapaian-keterangan" class="block text-sm font-medium text-gray-700 mb-2">Keterangan Pencapaian</label>
                            <textarea id="pencapaian-keterangan" name="pencapaian-keterangan" rows="3" required 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label for="pencapaian-hadiah" class="block text-sm font-medium text-gray-700 mb-2">Hadiah/Ganjaran</label>
                            <input type="text" id="pencapaian-hadiah" name="pencapaian-hadiah" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pencapaian-pemberi" class="block text-sm font-medium text-gray-700 mb-2">Pemberi Pengiktirafan</label>
                            <input type="text" id="pencapaian-pemberi" name="pencapaian-pemberi" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-yellow-600 text-white px-6 py-2 rounded-md hover:bg-yellow-700 transition duration-200">
                                Simpan Pengiktirafan
                            </button>
                        </div>
                    </form>
                    
                    <!-- Pencapaian Records Table -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Rekod Pengiktirafan Terkini</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Pelajar</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jenis</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Keterangan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Hadiah</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pemberi</th>
                                    </tr>
                                </thead>
                                <tbody id="pencapaian-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aktiviti Pelajar Section -->
            <div id="aktiviti-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Sistem Rekod Aktiviti Pelajar</h2>
                    
                    <!-- Club Organization Charts -->
                    <div class="mb-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Carta Kelab -->
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-100 p-6 rounded-lg">
                            <h3 class="text-lg font-bold text-indigo-800 mb-4">üìã Senarai Carta Kelab dan President Kelab</h3>
                            <div class="space-y-4">
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-blue-700 mb-2">üéµ Kelab Nasyid</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Ahmad Faiz bin Abdullah</p>
                                        <p><strong>Naib President:</strong> Muhammad Amin bin Hassan</p>
                                        <p><strong>Setiausaha:</strong> Zulkifli bin Omar</p>
                                        <p><strong>Bendahari:</strong> Hafiz bin Ismail</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-green-700 mb-2">üìñ Kelab Tilawah</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Abdul Rahman bin Yusof</p>
                                        <p><strong>Naib President:</strong> Mohd Syafiq bin Ali</p>
                                        <p><strong>Setiausaha:</strong> Firdaus bin Ahmad</p>
                                        <p><strong>Bendahari:</strong> Nazrul bin Ibrahim</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-orange-700 mb-2">‚öΩ Kelab Sukan</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Azman bin Razak</p>
                                        <p><strong>Naib President:</strong> Ridhwan bin Kamal</p>
                                        <p><strong>Setiausaha:</strong> Danial bin Mohd</p>
                                        <p><strong>Bendahari:</strong> Iqbal bin Sulaiman</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-purple-700 mb-2">üé® Kelab Seni/Gym</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Faizal bin Ahmad</p>
                                        <p><strong>Naib President:</strong> Haris bin Zulkifli</p>
                                        <p><strong>Setiausaha:</strong> Aidil bin Rahman</p>
                                        <p><strong>Bendahari:</strong> Syahrul bin Hassan</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-teal-700 mb-2">üì¢ Kelab Dakwah/Media</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Zulhilmi bin Omar</p>
                                        <p><strong>Naib President:</strong> Afiq bin Ismail</p>
                                        <p><strong>Setiausaha:</strong> Hakim bin Yusof</p>
                                        <p><strong>Bendahari:</strong> Razif bin Ali</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-indigo-700 mb-2">üïå Kelab Qosidah/Bimbingan Imam</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>President:</strong> Muhamad bin Abdullah</p>
                                        <p><strong>Naib President:</strong> Zakaria bin Ibrahim</p>
                                        <p><strong>Setiausaha:</strong> Hafizuddin bin Mohd</p>
                                        <p><strong>Bendahari:</strong> Amirul bin Sulaiman</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Carta Ketua Kawasan -->
                        <div class="bg-gradient-to-br from-green-50 to-emerald-100 p-6 rounded-lg">
                            <h3 class="text-lg font-bold text-emerald-800 mb-4">üè† Carta Ketua Kawasan</h3>
                            <div class="space-y-4">
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-red-700 mb-2">üÖ∞Ô∏è Kawasan A</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>Ketua Kawasan:</strong> Iskandar bin Zulkarnain</p>
                                        <p><strong>Timbalan Ketua:</strong> Hakim bin Rashid</p>
                                        <p><strong>AJK 1:</strong> Amir bin Zakaria</p>
                                        <p><strong>AJK 2:</strong> Farid bin Hamzah</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-blue-700 mb-2">üÖ±Ô∏è Kawasan B</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>Ketua Kawasan:</strong> Syahir bin Mahmud</p>
                                        <p><strong>Timbalan Ketua:</strong> Luqman bin Hakim</p>
                                        <p><strong>AJK 1:</strong> Haikal bin Rosli</p>
                                        <p><strong>AJK 2:</strong> Irfan bin Aziz</p>
                                    </div>
                                </div>
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h4 class="font-semibold text-purple-700 mb-2">üÖ≤ Kawasan C</h4>
                                    <div class="text-sm space-y-1">
                                        <p><strong>Ketua Kawasan:</strong> Arif bin Rahman</p>
                                        <p><strong>Timbalan Ketua:</strong> Zaid bin Othman</p>
                                        <p><strong>AJK 1:</strong> Haziq bin Nasir</p>
                                        <p><strong>AJK 2:</strong> Shafiq bin Halim</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form id="aktiviti-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="aktiviti-nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Pelajar</label>
                            <input type="text" id="aktiviti-nama" name="aktiviti-nama" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="aktiviti-no-kad" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="aktiviti-no-kad" name="aktiviti-no-kad" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="aktiviti-tarikh" class="block text-sm font-medium text-gray-700 mb-2">Tarikh</label>
                            <input type="date" id="aktiviti-tarikh" name="aktiviti-tarikh" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="aktiviti-jenis" class="block text-sm font-medium text-gray-700 mb-2">Jenis Aktiviti</label>
                            <select id="aktiviti-jenis" name="aktiviti-jenis" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Jenis</option>
                                <option value="kelab-tilawah">Kelab Tilawah</option>
                                <option value="kelab-nasyid">Kelab Nasyid</option>
                                <option value="kelab-sukan">Kelab Sukan</option>
                                <option value="kelab-bahasa">Kelab Bahasa</option>
                                <option value="kelab-seni-gym">Kelab Seni/Gym</option>
                                <option value="kelab-dakwah-media">Kelab Dakwah/Media</option>
                                <option value="kelab-qosidah-bimbingan-imam">Kelab Qosidah/Bimbingan Imam</option>
                                <option value="program-khusus">Program Khusus</option>
                                <option value="lawatan">Lawatan Sambil Belajar</option>
                                <option value="ceramah">Ceramah/Kuliah</option>
                                <option value="gotong-royong">Gotong-royong</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <label for="aktiviti-keterangan" class="block text-sm font-medium text-gray-700 mb-2">Keterangan Aktiviti</label>
                            <textarea id="aktiviti-keterangan" name="aktiviti-keterangan" rows="3" required 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div>
                            <label for="aktiviti-penyertaan" class="block text-sm font-medium text-gray-700 mb-2">Tahap Penyertaan</label>
                            <select id="aktiviti-penyertaan" name="aktiviti-penyertaan" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Tahap</option>
                                <option value="sangat-aktif">Sangat Aktif</option>
                                <option value="aktif">Aktif</option>
                                <option value="sederhana">Sederhana</option>
                                <option value="kurang-aktif">Kurang Aktif</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="aktiviti-guru" class="block text-sm font-medium text-gray-700 mb-2">Guru Pembimbing</label>
                            <input type="text" id="aktiviti-guru" name="aktiviti-guru" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded-md hover:bg-purple-700 transition duration-200">
                                Simpan Rekod Aktiviti
                            </button>
                        </div>
                    </form>
                    
                    <!-- Aktiviti Records Table -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Rekod Aktiviti Terkini</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Pelajar</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Jenis Aktiviti</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Keterangan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Penyertaan</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Guru</th>
                                    </tr>
                                </thead>
                                <tbody id="aktiviti-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Pelajar Section -->
            <div id="pelajar-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Data Pelajar & Maklumat Keluarga üîí</h2>
                    
                    <div class="mb-6 bg-red-50 border-l-4 border-red-400 p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-red-700">
                                    <strong>Maklumat Sulit:</strong> Bahagian ini mengandungi data peribadi pelajar dan keluarga. Hanya admin yang diberi kuasa boleh mengakses.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="pelajar-form" class="form-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Data Pelajar -->
                        <div class="md:col-span-2 lg:col-span-3">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2">üìã Maklumat Pelajar</h3>
                        </div>
                        
                        <div>
                            <label for="pelajar-nama-penuh" class="block text-sm font-medium text-gray-700 mb-2">Nama Penuh</label>
                            <input type="text" id="pelajar-nama-penuh" name="pelajar-nama-penuh" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-no-kad" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pelajar</label>
                            <input type="text" id="pelajar-no-kad" name="pelajar-no-kad" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Contoh: MT2024001">
                        </div>
                        
                        <div>
                            <label for="pelajar-ic" class="block text-sm font-medium text-gray-700 mb-2">No. Kad Pengenalan</label>
                            <input type="text" id="pelajar-ic" name="pelajar-ic" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-tarikh-lahir" class="block text-sm font-medium text-gray-700 mb-2">Tarikh Lahir</label>
                            <input type="date" id="pelajar-tarikh-lahir" name="pelajar-tarikh-lahir" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-jantina" class="block text-sm font-medium text-gray-700 mb-2">Jantina</label>
                            <select id="pelajar-jantina" name="pelajar-jantina" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Jantina</option>
                                <option value="lelaki">Lelaki</option>
                                <option value="perempuan">Perempuan</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="pelajar-kelas-semasa" class="block text-sm font-medium text-gray-700 mb-2">Kelas Semasa</label>
                            <select id="pelajar-kelas-semasa" name="pelajar-kelas-semasa" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Kelas</option>
                                <option value="mumtaz">Mumtaz</option>
                                <option value="jayyid">Jayyid</option>
                                <option value="maqbul">Maqbul</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="pelajar-tarikh-masuk" class="block text-sm font-medium text-gray-700 mb-2">Tarikh Masuk</label>
                            <input type="date" id="pelajar-tarikh-masuk" name="pelajar-tarikh-masuk" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <label for="pelajar-alamat" class="block text-sm font-medium text-gray-700 mb-2">Alamat Rumah</label>
                            <textarea id="pelajar-alamat" name="pelajar-alamat" rows="3" required 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <!-- Data Ibu Bapa/Penjaga -->
                        <div class="md:col-span-2 lg:col-span-3">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2 mt-6">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Maklumat Ibu Bapa/Penjaga</h3>
                        </div>
                        
                        <div>
                            <label for="pelajar-nama-wali" class="block text-sm font-medium text-gray-700 mb-2">Nama Wali/Ibu Bapa</label>
                            <input type="text" id="pelajar-nama-wali" name="pelajar-nama-wali" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-telefon-wali" class="block text-sm font-medium text-gray-700 mb-2">No. Telefon Wali</label>
                            <input type="tel" id="pelajar-telefon-wali" name="pelajar-telefon-wali" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-ic-wali" class="block text-sm font-medium text-gray-700 mb-2">No. IC Wali</label>
                            <input type="text" id="pelajar-ic-wali" name="pelajar-ic-wali" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-pekerjaan-wali" class="block text-sm font-medium text-gray-700 mb-2">Pekerjaan Wali</label>
                            <input type="text" id="pelajar-pekerjaan-wali" name="pelajar-pekerjaan-wali" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-pendapatan-wali" class="block text-sm font-medium text-gray-700 mb-2">Pendapatan Bulanan Wali</label>
                            <select id="pelajar-pendapatan-wali" name="pelajar-pendapatan-wali" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Julat</option>
                                <option value="bawah-1000">Bawah RM1,000</option>
                                <option value="1000-2000">RM1,000 - RM2,000</option>
                                <option value="2000-3000">RM2,000 - RM3,000</option>
                                <option value="3000-5000">RM3,000 - RM5,000</option>
                                <option value="atas-5000">Atas RM5,000</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="pelajar-alamat-wali" class="block text-sm font-medium text-gray-700 mb-2">Alamat Wali (jika berbeza)</label>
                            <textarea id="pelajar-alamat-wali" name="pelajar-alamat-wali" rows="2" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <!-- Wali Kecemasan -->
                        <div class="md:col-span-2 lg:col-span-3">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b pb-2 mt-6">üö® Maklumat Wali Kecemasan</h3>
                        </div>
                        
                        <div>
                            <label for="pelajar-wali-kecemasan" class="block text-sm font-medium text-gray-700 mb-2">Nama Wali Kecemasan</label>
                            <input type="text" id="pelajar-wali-kecemasan" name="pelajar-wali-kecemasan" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-telefon-kecemasan" class="block text-sm font-medium text-gray-700 mb-2">No. Telefon Kecemasan</label>
                            <input type="tel" id="pelajar-telefon-kecemasan" name="pelajar-telefon-kecemasan" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label for="pelajar-hubungan-kecemasan" class="block text-sm font-medium text-gray-700 mb-2">Hubungan Wali Kecemasan</label>
                            <select id="pelajar-hubungan-kecemasan" name="pelajar-hubungan-kecemasan" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Hubungan</option>
                                <option value="datuk-nenek">Datuk/Nenek</option>
                                <option value="bapa-saudara">Bapa Saudara</option>
                                <option value="ibu-saudara">Ibu Saudara</option>
                                <option value="abang-kakak">Abang/Kakak</option>
                                <option value="lain-lain">Lain-lain</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="pelajar-status" class="block text-sm font-medium text-gray-700 mb-2">Status Pelajar</label>
                            <select id="pelajar-status" name="pelajar-status" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Pilih Status</option>
                                <option value="aktif">Aktif</option>
                                <option value="cuti">Cuti</option>
                                <option value="tamat">Tamat Pengajian</option>
                                <option value="berhenti">Berhenti</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2 lg:col-span-3">
                            <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition duration-200">
                                Simpan Data Pelajar
                            </button>
                        </div>
                    </form>
                    
                    <!-- Pelajar Records Table -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Senarai Pelajar</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Penuh</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. Kad</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No. IC</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kelas</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tarikh Masuk</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Wali</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="pelajar-records" class="divide-y divide-gray-200">
                                    <!-- Records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tetapan Section -->
            <div id="tetapan-section" class="section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Tetapan Sistem üîí</h2>
                    
                    <div class="mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    <strong>Amaran:</strong> Tetapan ini akan mempengaruhi keseluruhan sistem. Pastikan anda faham sebelum membuat perubahan.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- Tetapan Umum -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tetapan Umum</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="nama-institusi" class="block text-sm font-medium text-gray-700 mb-2">Nama Institusi</label>
                                    <input type="text" id="nama-institusi" value="Mahad Tahfiz Al-Quran" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="alamat-institusi" class="block text-sm font-medium text-gray-700 mb-2">Alamat Institusi</label>
                                    <textarea id="alamat-institusi" rows="3" 
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">Jalan Masjid, Taman Islami, 12345 Kuala Lumpur</textarea>
                                </div>
                                
                                <div>
                                    <label for="telefon-institusi" class="block text-sm font-medium text-gray-700 mb-2">No. Telefon</label>
                                    <input type="tel" id="telefon-institusi" value="03-12345678" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <button id="save-general-settings" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                    Simpan Tetapan Umum
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tetapan Penampilan -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tetapan Penampilan</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="upload-logo" class="block text-sm font-medium text-gray-700 mb-2">Logo Institusi</label>
                                    <input type="file" id="upload-logo" accept="image/*" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <div id="logo-preview" class="mt-2 hidden">
                                        <img id="logo-preview-img" class="logo-preview" alt="Logo Preview">
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="upload-wallpaper" class="block text-sm font-medium text-gray-700 mb-2">Wallpaper Latar Belakang</label>
                                    <input type="file" id="upload-wallpaper" accept="image/*" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <div id="wallpaper-preview" class="mt-2 hidden">
                                        <img id="wallpaper-preview-img" class="logo-preview" alt="Wallpaper Preview">
                                    </div>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button id="save-appearance-settings" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition duration-200">
                                        Simpan Penampilan
                                    </button>
                                    <button id="reset-appearance" class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                                        Reset Default
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tetapan Pengguna -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengurusan Pengguna</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="tambah-pengguna" class="block text-sm font-medium text-gray-700 mb-2">Nama Pengguna Baru</label>
                                    <input type="text" id="tambah-pengguna" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="kata-laluan-baru" class="block text-sm font-medium text-gray-700 mb-2">Kata Laluan</label>
                                    <input type="password" id="kata-laluan-baru" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="peranan-pengguna" class="block text-sm font-medium text-gray-700 mb-2">Peranan</label>
                                    <select id="peranan-pengguna" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="admin">Admin</option>
                                        <option value="guru">Guru</option>
                                        <option value="pembantu">Pembantu</option>
                                    </select>
                                </div>
                                
                                <button id="add-user-btn" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                    Tambah Pengguna
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tetapan Backup -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Backup & Restore Automatik</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="auto-backup-toggle" checked class="mr-2">
                                        <span class="text-sm">Backup Automatik</span>
                                    </label>
                                </div>
                                
                                <div>
                                    <label for="backup-interval" class="block text-sm font-medium text-gray-700 mb-2">Selang Backup (Jam)</label>
                                    <select id="backup-interval" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="6">Setiap 6 Jam</option>
                                        <option value="12">Setiap 12 Jam</option>
                                        <option value="24" selected>Setiap 24 Jam</option>
                                        <option value="48">Setiap 48 Jam</option>
                                        <option value="168">Setiap Minggu</option>
                                    </select>
                                </div>
                                
                                <div class="text-sm text-gray-600 bg-white p-3 rounded border">
                                    <p><strong>Status:</strong> <span id="backup-status">Aktif</span></p>
                                    <p><strong>Backup terakhir:</strong> <span id="last-backup-time">15/12/2024 10:30 AM</span></p>
                                    <p><strong>Backup seterusnya:</strong> <span id="next-backup-time">16/12/2024 10:30 AM</span></p>
                                    <p><strong>Saiz data:</strong> <span id="data-size">2.3 MB</span></p>
                                </div>
                                
                                <button id="manual-backup" class="bg-orange-600 text-white px-4 py-2 rounded-md hover:bg-orange-700 transition duration-200 w-full">
                                    Buat Backup Sekarang
                                </button>
                                
                                <div>
                                    <label for="restore-file" class="block text-sm font-medium text-gray-700 mb-2">Pilih Fail Backup untuk Restore</label>
                                    <input type="file" id="restore-file" accept=".json" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <button id="restore-data" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition duration-200 w-full">
                                    Restore Data
                                </button>
                                
                                <button id="download-backup" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200 w-full">
                                    Muat Turun Backup
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tetapan Jenis Aktiviti -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengurusan Jenis Aktiviti</h3>
                            
                            <div class="space-y-4">
                                <!-- Add New Activity Type -->
                                <div class="bg-white p-4 rounded-lg border">
                                    <h4 class="text-md font-medium text-gray-700 mb-3">Tambah Jenis Aktiviti Baru</h4>
                                    <div class="flex space-x-2">
                                        <input type="text" id="new-activity-type" placeholder="Nama jenis aktiviti baru..." 
                                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <button id="add-activity-type" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                            Tambah
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Current Activity Types -->
                                <div class="bg-white p-4 rounded-lg border">
                                    <h4 class="text-md font-medium text-gray-700 mb-3">Senarai Jenis Aktiviti Semasa</h4>
                                    <div id="activity-types-list" class="space-y-2 max-h-48 overflow-y-auto">
                                        <!-- Activity types will be populated here -->
                                    </div>
                                </div>
                                
                                <button id="save-activity-settings" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 w-full">
                                    Simpan Tetapan Aktiviti
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tetapan Kemaskini Automatik -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tetapan Kemaskini Automatik</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-auto-updates" checked class="mr-2">
                                        <span class="text-sm">Aktifkan kemaskini automatik</span>
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">Sistem akan memberitahu semua pengguna apabila ada rekod baharu</p>
                                </div>
                                
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-update-notifications" checked class="mr-2">
                                        <span class="text-sm">Notifikasi kemaskini</span>
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">Paparkan notifikasi pop-up untuk kemaskini baharu</p>
                                </div>
                                
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-sound-notifications" class="mr-2">
                                        <span class="text-sm">Bunyi notifikasi</span>
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">Mainkan bunyi apabila ada kemaskini baharu</p>
                                </div>
                                
                                <div>
                                    <label for="update-retention-days" class="block text-sm font-medium text-gray-700 mb-2">Simpan kemaskini selama (hari)</label>
                                    <select id="update-retention-days" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="7">7 hari</option>
                                        <option value="14">14 hari</option>
                                        <option value="30" selected>30 hari</option>
                                        <option value="60">60 hari</option>
                                        <option value="90">90 hari</option>
                                    </select>
                                </div>
                                
                                <div class="bg-white p-3 rounded border">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Statistik Kemaskini</h4>
                                    <div class="grid grid-cols-2 gap-4 text-xs text-gray-600">
                                        <div>
                                            <span class="font-medium">Hari ini:</span>
                                            <span id="updates-today-count">0</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">Minggu ini:</span>
                                            <span id="updates-week-count">0</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">Bulan ini:</span>
                                            <span id="updates-month-count">0</span>
                                        </div>
                                        <div>
                                            <span class="font-medium">Jumlah:</span>
                                            <span id="updates-total-count">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <button id="save-update-settings" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-200 w-full">
                                    Simpan Tetapan Kemaskini
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tetapan Supabase -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tetapan Supabase Database</h3>
                            
                            <div class="space-y-4">
                                <div class="bg-white p-4 rounded-lg border">
                                    <h4 class="text-md font-medium text-gray-700 mb-3">Status Sambungan</h4>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <div id="supabase-status-indicator" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                                            <span id="supabase-status-text" class="text-sm text-gray-600">Memeriksa sambungan...</span>
                                        </div>
                                        <button id="test-supabase-connection" class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded hover:bg-blue-200 transition duration-200">
                                            Uji Sambungan
                                        </button>
                                    </div>
                                    <div class="mt-2 text-xs text-gray-500">
                                        <p><strong>URL:</strong> <span id="current-supabase-url">${SUPABASE_URL}</span></p>
                                        <p><strong>Sync Terakhir:</strong> <span id="last-sync-time">Belum pernah</span></p>
                                        <p><strong>Item dalam Queue:</strong> <span id="sync-queue-count">0</span></p>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="supabase-url-input" class="block text-sm font-medium text-gray-700 mb-2">Supabase Project URL</label>
                                    <input type="url" id="supabase-url-input" 
                                           placeholder="https://your-project-id.supabase.co"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label for="supabase-key-input" class="block text-sm font-medium text-gray-700 mb-2">Supabase Anon Key</label>
                                    <input type="password" id="supabase-key-input" 
                                           placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-supabase-sync" checked class="mr-2">
                                        <span class="text-sm">Aktifkan penyegerakan automatik</span>
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">Data akan disegerakkan dengan Supabase secara automatik</p>
                                </div>
                                
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-realtime-updates" checked class="mr-2">
                                        <span class="text-sm">Kemaskini masa nyata</span>
                                    </label>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">Terima kemaskini dari pengguna lain secara masa nyata</p>
                                </div>
                                
                                <div class="flex space-x-2">
                                    <button id="save-supabase-settings" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                        Simpan & Sambung
                                    </button>
                                    <button id="force-sync-now" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                        Sync Sekarang
                                    </button>
                                </div>
                                
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <h5 class="text-sm font-medium text-yellow-800 mb-2">üìã Setup Supabase Database</h5>
                                    <div class="text-xs text-yellow-700 space-y-1">
                                        <p><strong>1.</strong> Buat project baharu di <a href="https://supabase.com" target="_blank" class="underline">supabase.com</a></p>
                                        <p><strong>2.</strong> Salin Project URL dan Anon Key dari Settings > API</p>
                                        <p><strong>3.</strong> Jalankan SQL berikut untuk membuat jadual:</p>
                                        <button id="show-sql-schema" class="mt-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded hover:bg-yellow-200 transition duration-200">
                                            Tunjukkan SQL Schema
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tetapan Laporan -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tetapan Laporan</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="mr-2">
                                        <span class="text-sm">Auto-generate laporan bulanan</span>
                                    </label>
                                </div>
                                
                                <div>
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="mr-2">
                                        <span class="text-sm">Email laporan kepada pentadbir</span>
                                    </label>
                                </div>
                                
                                <div>
                                    <label for="email-laporan" class="block text-sm font-medium text-gray-700 mb-2">Email Laporan</label>
                                    <input type="email" id="email-laporan" value="admin@mahadtahfiz.edu.my" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <button class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition duration-200">
                                    Simpan Tetapan Laporan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ===== SUPABASE CONFIGURATION =====
        const SUPABASE_URL = 'https://your-project-url.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key-here';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Database connection status
        let isOnline = true;
        let syncQueue = [];
        
        // Global variables
        let currentUser = null;
        let currentSection = 'hafazan';
        let hafazanRecords = [];
        let prestasiRecords = [];
        let disiplinRecords = [];
        let pencapaianRecords = [];
        let aktivitiRecords = [];
        let pelajarRecords = [];
        let systemSettings = {
            institutionName: 'Mahad Tahfiz Al-Quran',
            institutionAddress: 'Jalan Masjid, Taman Islami, 12345 Kuala Lumpur',
            institutionPhone: '03-12345678',
            logoUrl: '',
            wallpaperUrl: '',
            autoBackup: true,
            backupInterval: 24, // hours
            autoUpdates: true,
            updateNotifications: true,
            supabaseUrl: SUPABASE_URL,
            supabaseKey: SUPABASE_ANON_KEY,
            syncEnabled: true,
            lastSync: null
        };
        let lastBackupTime = null;
        let systemUsers = [];
        let systemUpdates = [];
        let unreadUpdates = 0;
        
        // Activity types management
        let activityTypes = [
            { id: 1, name: 'kelab-tilawah', label: 'Kelab Tilawah', default: true },
            { id: 2, name: 'kelab-nasyid', label: 'Kelab Nasyid', default: true },
            { id: 3, name: 'kelab-sukan', label: 'Kelab Sukan', default: true },
            { id: 4, name: 'kelab-bahasa', label: 'Kelab Bahasa', default: true },
            { id: 5, name: 'program-khusus', label: 'Program Khusus', default: true },
            { id: 6, name: 'lawatan', label: 'Lawatan Sambil Belajar', default: true },
            { id: 7, name: 'ceramah', label: 'Ceramah/Kuliah', default: true },
            { id: 8, name: 'gotong-royong', label: 'Gotong-royong', default: true },
            { id: 9, name: 'kelab-seni-gym', label: 'Kelab Seni/Gym', default: true },
            { id: 10, name: 'kelab-dakwah-media', label: 'Kelab Dakwah/Media', default: true },
            { id: 11, name: 'kelab-qosidah-bimbingan-imam', label: 'Kelab Qosidah/Bimbingan Imam', default: true }
        ];

        // Security questions database (demo purposes)
        const securityDatabase = {
            'admin': {
                password: 'admin123',
                securityAnswers: {
                    school: 'sk taman',
                    mother: 'siti',
                    birthplace: 'kuala lumpur'
                }
            }
        };

        // ===== SUPABASE DATABASE FUNCTIONS =====
        
        // Check connection status
        async function checkConnection() {
            try {
                const { data, error } = await supabase.from('system_health').select('*').limit(1);
                isOnline = !error;
                updateConnectionStatus();
                return isOnline;
            } catch (err) {
                isOnline = false;
                updateConnectionStatus();
                return false;
            }
        }
        
        // Update connection status indicator
        function updateConnectionStatus() {
            let statusIndicator = document.getElementById('connection-status');
            if (!statusIndicator) {
                statusIndicator = document.createElement('div');
                statusIndicator.id = 'connection-status';
                statusIndicator.className = 'fixed top-4 right-4 z-50 px-3 py-1 rounded-full text-xs font-medium';
                document.body.appendChild(statusIndicator);
            }
            
            if (isOnline) {
                statusIndicator.className = 'fixed top-4 right-4 z-50 px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800';
                statusIndicator.innerHTML = 'üü¢ Online - Supabase Connected';
            } else {
                statusIndicator.className = 'fixed top-4 right-4 z-50 px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800';
                statusIndicator.innerHTML = 'üî¥ Offline - Local Mode';
            }
        }
        
        // Sync data to Supabase
        async function syncToSupabase(table, data, operation = 'insert') {
            if (!isOnline || !systemSettings.syncEnabled) {
                // Add to sync queue for later
                syncQueue.push({ table, data, operation, timestamp: new Date().toISOString() });
                localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
                return { success: false, queued: true };
            }
            
            try {
                let result;
                switch (operation) {
                    case 'insert':
                        result = await supabase.from(table).insert(data);
                        break;
                    case 'update':
                        result = await supabase.from(table).update(data).eq('id', data.id);
                        break;
                    case 'delete':
                        result = await supabase.from(table).delete().eq('id', data.id);
                        break;
                }
                
                if (result.error) {
                    console.error('Supabase sync error:', result.error);
                    syncQueue.push({ table, data, operation, timestamp: new Date().toISOString() });
                    return { success: false, error: result.error };
                }
                
                return { success: true, data: result.data };
            } catch (error) {
                console.error('Sync error:', error);
                syncQueue.push({ table, data, operation, timestamp: new Date().toISOString() });
                return { success: false, error };
            }
        }
        
        // Load data from Supabase
        async function loadFromSupabase(table, orderBy = 'created_at') {
            if (!isOnline) {
                return { success: false, data: [] };
            }
            
            try {
                const { data, error } = await supabase
                    .from(table)
                    .select('*')
                    .order(orderBy, { ascending: false });
                
                if (error) {
                    console.error('Load error:', error);
                    return { success: false, error };
                }
                
                return { success: true, data: data || [] };
            } catch (error) {
                console.error('Load error:', error);
                return { success: false, error };
            }
        }
        
        // Process sync queue
        async function processSyncQueue() {
            if (!isOnline || syncQueue.length === 0) return;
            
            const queueCopy = [...syncQueue];
            syncQueue = [];
            
            for (const item of queueCopy) {
                const result = await syncToSupabase(item.table, item.data, item.operation);
                if (!result.success && !result.queued) {
                    // Re-add failed items to queue
                    syncQueue.push(item);
                }
            }
            
            localStorage.setItem('syncQueue', JSON.stringify(syncQueue));
            
            if (syncQueue.length === 0) {
                showNotification('Semua data berjaya disegerakkan dengan Supabase!', 'success');
            }
        }
        
        // Real-time subscriptions
        function setupRealtimeSubscriptions() {
            if (!isOnline) return;
            
            // Subscribe to hafazan changes
            supabase
                .channel('hafazan_changes')
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: 'hafazan_records' },
                    (payload) => handleRealtimeUpdate('hafazan', payload)
                )
                .subscribe();
            
            // Subscribe to prestasi changes
            supabase
                .channel('prestasi_changes')
                .on('postgres_changes',
                    { event: '*', schema: 'public', table: 'prestasi_records' },
                    (payload) => handleRealtimeUpdate('prestasi', payload)
                )
                .subscribe();
            
            // Subscribe to other tables...
            ['disiplin_records', 'pencapaian_records', 'aktiviti_records', 'pelajar_records'].forEach(table => {
                const channel = table.replace('_records', '');
                supabase
                    .channel(`${channel}_changes`)
                    .on('postgres_changes',
                        { event: '*', schema: 'public', table: table },
                        (payload) => handleRealtimeUpdate(channel, payload)
                    )
                    .subscribe();
            });
        }
        
        // Handle real-time updates
        function handleRealtimeUpdate(type, payload) {
            const { eventType, new: newRecord, old: oldRecord } = payload;
            
            switch (eventType) {
                case 'INSERT':
                    // Add new record to local array
                    addRealtimeRecord(type, newRecord);
                    createSystemUpdate(type, 'Rekod Baharu (Real-time)', 
                        `${newRecord.nama || 'Rekod baharu'} - ${newRecord.surah || newRecord.jenis || 'Data dikemaskini'}`, 
                        newRecord);
                    break;
                case 'UPDATE':
                    // Update existing record
                    updateRealtimeRecord(type, newRecord);
                    break;
                case 'DELETE':
                    // Remove record from local array
                    deleteRealtimeRecord(type, oldRecord);
                    break;
            }
            
            // Refresh the appropriate table
            updateTableByType(type);
        }
        
        // Add real-time record to local arrays
        function addRealtimeRecord(type, record) {
            const arrays = {
                'hafazan': hafazanRecords,
                'prestasi': prestasiRecords,
                'disiplin': disiplinRecords,
                'pencapaian': pencapaianRecords,
                'aktiviti': aktivitiRecords,
                'pelajar': pelajarRecords
            };
            
            const targetArray = arrays[type];
            if (targetArray && !targetArray.find(r => r.id === record.id)) {
                targetArray.unshift(record);
            }
        }
        
        // Update real-time record in local arrays
        function updateRealtimeRecord(type, record) {
            const arrays = {
                'hafazan': hafazanRecords,
                'prestasi': prestasiRecords,
                'disiplin': disiplinRecords,
                'pencapaian': pencapaianRecords,
                'aktiviti': aktivitiRecords,
                'pelajar': pelajarRecords
            };
            
            const targetArray = arrays[type];
            if (targetArray) {
                const index = targetArray.findIndex(r => r.id === record.id);
                if (index !== -1) {
                    targetArray[index] = record;
                }
            }
        }
        
        // Delete real-time record from local arrays
        function deleteRealtimeRecord(type, record) {
            const arrays = {
                'hafazan': hafazanRecords,
                'prestasi': prestasiRecords,
                'disiplin': disiplinRecords,
                'pencapaian': pencapaianRecords,
                'aktiviti': aktivitiRecords,
                'pelajar': pelajarRecords
            };
            
            const targetArray = arrays[type];
            if (targetArray) {
                const index = targetArray.findIndex(r => r.id === record.id);
                if (index !== -1) {
                    targetArray.splice(index, 1);
                }
            }
        }
        
        // Update table by type
        function updateTableByType(type) {
            const updateFunctions = {
                'hafazan': updateHafazanTable,
                'prestasi': updatePrestasiTable,
                'disiplin': updateDisiplinTable,
                'pencapaian': updatePencapaianTable,
                'aktiviti': updateAktivitiTable,
                'pelajar': updatePelajarTable
            };
            
            const updateFunction = updateFunctions[type];
            if (updateFunction) {
                updateFunction();
            }
        }
        
        // Initialize Supabase connection
        async function initializeSupabase() {
            showNotification('Menyambung ke Supabase...', 'info');
            
            // Check connection
            await checkConnection();
            
            if (isOnline) {
                // Load sync queue from localStorage
                const savedQueue = localStorage.getItem('syncQueue');
                if (savedQueue) {
                    syncQueue = JSON.parse(savedQueue);
                }
                
                // Setup real-time subscriptions
                setupRealtimeSubscriptions();
                
                // Process any pending sync items
                await processSyncQueue();
                
                // Load initial data from Supabase
                await loadAllDataFromSupabase();
                
                showNotification('Berjaya disambung ke Supabase!', 'success');
            } else {
                showNotification('Tidak dapat sambung ke Supabase. Menggunakan mod offline.', 'warning');
            }
            
            // Set up periodic connection checks
            setInterval(checkConnection, 30000); // Check every 30 seconds
            setInterval(processSyncQueue, 60000); // Process queue every minute
        }
        
        // Load all data from Supabase
        async function loadAllDataFromSupabase() {
            if (!isOnline) return;
            
            try {
                // Load hafazan records
                const hafazanResult = await loadFromSupabase('hafazan_records');
                if (hafazanResult.success) {
                    hafazanRecords = hafazanResult.data;
                }
                
                // Load prestasi records
                const prestasiResult = await loadFromSupabase('prestasi_records');
                if (prestasiResult.success) {
                    prestasiRecords = prestasiResult.data;
                }
                
                // Load disiplin records
                const disiplinResult = await loadFromSupabase('disiplin_records');
                if (disiplinResult.success) {
                    disiplinRecords = disiplinResult.data;
                }
                
                // Load pencapaian records
                const pencapaianResult = await loadFromSupabase('pencapaian_records');
                if (pencapaianResult.success) {
                    pencapaianRecords = pencapaianResult.data;
                }
                
                // Load aktiviti records
                const aktivitiResult = await loadFromSupabase('aktiviti_records');
                if (aktivitiResult.success) {
                    aktivitiRecords = aktivitiResult.data;
                }
                
                // Load pelajar records
                const pelajarResult = await loadFromSupabase('pelajar_records');
                if (pelajarResult.success) {
                    pelajarRecords = pelajarResult.data;
                }
                
                // Update all tables
                updateAllTables();
                
                // Update last sync time
                systemSettings.lastSync = new Date().toISOString();
                localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
                
            } catch (error) {
                console.error('Error loading data from Supabase:', error);
                showNotification('Ralat semasa memuat data dari Supabase', 'error');
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateScreenIndicator();
            window.addEventListener('resize', updateScreenIndicator);
            
            // Initialize Supabase after DOM is ready
            initializeSupabase();
        });

        function initializeApp() {
            // Set current date for date inputs
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });

            // Load system settings
            loadSystemSettings();
            
            // Load activity types
            loadActivityTypes();
            
            // Load system users
            loadSystemUsers();

            // Initialize sample data
            initializeSampleData();
            
            // Initialize activity types
            updateActivityTypesList();
            updateActivityTypesDropdown();
            
            // Initialize user list display
            setTimeout(() => {
                updateUsersList();
            }, 100);
            
            // Initialize update system
            loadSystemUpdates();
            updateUpdatesDisplay();
            startUpdatePolling();
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', handleOutsideClick);
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Forgot password
            document.getElementById('forgot-password').addEventListener('click', openPasswordRecovery);
            
            // Password recovery modal
            setupPasswordRecoveryListeners();
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', (e) => switchSection(e.target.dataset.section));
            });
            
            // Forms
            document.getElementById('hafazan-form').addEventListener('submit', handleHafazanSubmit);
            document.getElementById('prestasi-form').addEventListener('submit', handlePrestasiSubmit);
            document.getElementById('disiplin-form').addEventListener('submit', handleDisiplinSubmit);
            document.getElementById('pencapaian-form').addEventListener('submit', handlePencapaianSubmit);
            document.getElementById('aktiviti-form').addEventListener('submit', handleAktivitiSubmit);
            document.getElementById('pelajar-form').addEventListener('submit', handlePelajarSubmit);
            
            // Settings
            document.getElementById('save-general-settings').addEventListener('click', saveGeneralSettings);
            document.getElementById('save-appearance-settings').addEventListener('click', saveAppearanceSettings);
            document.getElementById('reset-appearance').addEventListener('click', resetAppearance);
            document.getElementById('upload-logo').addEventListener('change', previewLogo);
            document.getElementById('upload-wallpaper').addEventListener('change', previewWallpaper);
            
            // User Management
            document.getElementById('add-user-btn').addEventListener('click', addNewUser);
            
            // Update System
            document.getElementById('updates-btn').addEventListener('click', toggleUpdatesDropdown);
            document.getElementById('mark-all-read').addEventListener('click', markAllUpdatesRead);
            document.getElementById('clear-all-updates').addEventListener('click', clearAllUpdates);
            document.getElementById('toggle-auto-updates').addEventListener('click', toggleAutoUpdatesSettings);
            document.getElementById('save-update-settings').addEventListener('click', saveUpdateSettings);
            
            // Backup & Restore
            document.getElementById('manual-backup').addEventListener('click', createManualBackup);
            document.getElementById('download-backup').addEventListener('click', downloadBackup);
            document.getElementById('restore-data').addEventListener('click', restoreData);
            document.getElementById('auto-backup-toggle').addEventListener('change', toggleAutoBackup);
            document.getElementById('backup-interval').addEventListener('change', updateBackupInterval);
            
            // Supabase Settings
            document.getElementById('test-supabase-connection').addEventListener('click', testSupabaseConnection);
            document.getElementById('save-supabase-settings').addEventListener('click', saveSupabaseSettings);
            document.getElementById('force-sync-now').addEventListener('click', forceSyncNow);
            document.getElementById('show-sql-schema').addEventListener('click', showSQLSchema);
            
            // Activity Types Management
            document.getElementById('add-activity-type').addEventListener('click', addActivityType);
            document.getElementById('save-activity-settings').addEventListener('click', saveActivitySettings);
            
            // Print & Export
            document.getElementById('print-hafazan').addEventListener('click', () => printReport('hafazan'));
            document.getElementById('print-prestasi').addEventListener('click', () => printReport('prestasi'));
            document.getElementById('print-disiplin').addEventListener('click', () => printReport('disiplin'));
            document.getElementById('export-hafazan').addEventListener('click', () => exportToExcel('hafazan'));
            document.getElementById('export-prestasi').addEventListener('click', () => exportToExcel('prestasi'));
            document.getElementById('export-disiplin').addEventListener('click', () => exportToExcel('disiplin'));
            
            // Dynamic form handlers
            document.getElementById('jenis-hafalan').addEventListener('change', handleJenisHafalanChange);
            
            // Search and filter handlers
            document.getElementById('apply-prestasi-filter').addEventListener('click', applyPrestasiFilter);
            document.getElementById('reset-prestasi-filter').addEventListener('click', resetPrestasiFilter);
            document.getElementById('apply-disiplin-filter').addEventListener('click', applyDisiplinFilter);
            document.getElementById('reset-disiplin-filter').addEventListener('click', resetDisiplinFilter);
        }

        function setupPasswordRecoveryListeners() {
            // Close modal
            document.getElementById('close-recovery-modal').addEventListener('click', closePasswordRecovery);
            document.getElementById('close-recovery-success').addEventListener('click', closePasswordRecovery);
            
            // Step navigation
            document.getElementById('verify-username').addEventListener('click', verifyUsername);
            document.getElementById('back-to-step-1').addEventListener('click', () => showRecoveryStep(1));
            document.getElementById('verify-security').addEventListener('click', verifySecurityAnswers);
            document.getElementById('back-to-step-2').addEventListener('click', () => showRecoveryStep(2));
            document.getElementById('reset-password').addEventListener('click', resetPassword);
        }

        function openPasswordRecovery() {
            document.getElementById('password-recovery-modal').classList.remove('hidden');
            showRecoveryStep(1);
        }

        function closePasswordRecovery() {
            document.getElementById('password-recovery-modal').classList.add('hidden');
            // Reset all inputs
            document.getElementById('recovery-username').value = '';
            document.getElementById('security-answer-1').value = '';
            document.getElementById('security-answer-2').value = '';
            document.getElementById('security-answer-3').value = '';
            document.getElementById('new-recovery-password').value = '';
            document.getElementById('confirm-recovery-password').value = '';
            showRecoveryStep(1);
        }

        function showRecoveryStep(step) {
            // Hide all steps
            document.querySelectorAll('.recovery-step').forEach(el => el.classList.add('hidden'));
            // Show current step
            document.getElementById(`recovery-step-${step}`).classList.remove('hidden');
        }

        function verifyUsername() {
            const username = document.getElementById('recovery-username').value.trim();
            
            if (!username) {
                showNotification('Sila masukkan nama pengguna', 'error');
                return;
            }
            
            if (!securityDatabase[username]) {
                showNotification('Nama pengguna tidak dijumpai', 'error');
                return;
            }
            
            showNotification('Nama pengguna disahkan. Sila jawab soalan keselamatan.', 'success');
            showRecoveryStep(2);
        }

        function verifySecurityAnswers() {
            const username = document.getElementById('recovery-username').value.trim();
            const answer1 = document.getElementById('security-answer-1').value.trim().toLowerCase();
            const answer2 = document.getElementById('security-answer-2').value.trim().toLowerCase();
            const answer3 = document.getElementById('security-answer-3').value.trim().toLowerCase();
            
            if (!answer1 || !answer2 || !answer3) {
                showNotification('Sila jawab semua soalan keselamatan', 'error');
                return;
            }
            
            const userSecurity = securityDatabase[username].securityAnswers;
            
            if (answer1 === userSecurity.school && 
                answer2 === userSecurity.mother && 
                answer3 === userSecurity.birthplace) {
                showNotification('Jawapan keselamatan betul. Sila masukkan kata laluan baru.', 'success');
                showRecoveryStep(3);
            } else {
                showNotification('Jawapan keselamatan tidak betul. Sila cuba lagi.', 'error');
            }
        }

        function resetPassword() {
            const newPassword = document.getElementById('new-recovery-password').value;
            const confirmPassword = document.getElementById('confirm-recovery-password').value;
            
            if (!newPassword || !confirmPassword) {
                showNotification('Sila masukkan kata laluan baru dan pengesahan', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Kata laluan tidak sepadan', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('Kata laluan mestilah sekurang-kurangnya 6 aksara', 'error');
                return;
            }
            
            // Update password in database (demo purposes)
            const username = document.getElementById('recovery-username').value.trim();
            securityDatabase[username].password = newPassword;
            
            showNotification('Kata laluan berjaya dikemaskini!', 'success');
            showRecoveryStep(4);
        }

        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Demo login - check against security database
            if (securityDatabase[username] && securityDatabase[username].password === password) {
                currentUser = { username: username, role: 'Admin' };
                document.getElementById('current-user').textContent = username;
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                showNotification('Log masuk berjaya!', 'success');
            } else {
                showNotification('Nama pengguna atau kata laluan tidak betul', 'error');
            }
        }

        function handleLogout() {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            showNotification('Anda telah log keluar', 'info');
        }

        function switchSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-gray-700');
                btn.classList.add('hover:bg-gray-700');
            });
            document.querySelector(`[data-section="${section}"]`).classList.add('bg-gray-700');
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(`${section}-section`).classList.remove('hidden');
            currentSection = section;
        }

        function handleJenisHafalanChange(e) {
            const jenisHafalan = e.target.value;
            const sabaqFields = document.getElementById('sabaq-fields');
            const sabqiManzilFields = document.getElementById('sabqi-manzil-fields');
            
            // Hide all fields first
            sabaqFields.classList.add('hidden');
            sabqiManzilFields.classList.add('hidden');
            
            // Show relevant fields based on selection
            if (jenisHafalan === 'sabaq') {
                sabaqFields.classList.remove('hidden');
            } else if (jenisHafalan === 'sabqi' || jenisHafalan === 'manzil') {
                sabqiManzilFields.classList.remove('hidden');
            }
        }

        async function handleHafazanSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: new Date().toLocaleDateString('ms-MY'),
                nama: formData.get('nama-pelajar'),
                noKad: formData.get('no-kad-pelajar'),
                kelas: formData.get('kelas'),
                jenisHafalan: formData.get('jenis-hafalan'),
                surah: formData.get('surah'),
                keputusan: formData.get('keputusan'),
                kehadiran: formData.get('kehadiran'),
                ustaz: formData.get('ustaz-tasmik'),
                catatan: formData.get('catatan-ustaz') || '',
                // Additional fields for sabaq
                bilanganBaris: formData.get('sabaq-bilangan-baris') || '',
                // Additional fields for sabqi/manzil
                sabqiSebelum: formData.get('sabqi-sebelum') || '',
                sabqiAkanDatang: formData.get('sabqi-akan-datang') || '',
                ayatAwal: formData.get('ayat-awal') || '',
                ayatAkhir: formData.get('ayat-akhir') || '',
                sasaranBarisJuzuk: formData.get('sasaran-baris-juzuk') || '',
                pilihanJuzukMuka: formData.get('pilihan-juzuk-muka') || '',
                created_at: new Date().toISOString(),
                user_id: currentUser?.username || 'admin'
            };
            
            // Add to local array
            hafazanRecords.unshift(record);
            updateHafazanTable();
            
            // Sync to Supabase
            const syncResult = await syncToSupabase('hafazan_records', record, 'insert');
            if (syncResult.success) {
                showNotification('Rekod hafazan berjaya disimpan dan disegerakkan!', 'success');
            } else if (syncResult.queued) {
                showNotification('Rekod hafazan disimpan. Akan disegerakkan apabila online.', 'warning');
            } else {
                showNotification('Rekod hafazan disimpan secara tempatan. Ralat penyegerakan.', 'error');
            }
            
            e.target.reset();
            
            // Hide dynamic fields after reset
            document.getElementById('sabaq-fields').classList.add('hidden');
            document.getElementById('sabqi-manzil-fields').classList.add('hidden');
            
            // Create system update
            createSystemUpdate('hafazan', 'Rekod Hafazan Baharu', `${record.nama} - ${record.surah} (${record.keputusan})`, record);
            
            // Auto-create prestasi record
            createAutoPrestasiRecord(record);
        }

        function handlePrestasiSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: formData.get('prestasi-tarikh'),
                hari: formData.get('prestasi-hari'),
                nama: formData.get('prestasi-nama'),
                noKad: formData.get('prestasi-no-kad'),
                surah: formData.get('prestasi-surah'),
                keputusan: formData.get('prestasi-keputusan'),
                catatan: formData.get('prestasi-catatan') || 'Manual entry'
            };
            
            prestasiRecords.unshift(record);
            updatePrestasiTable();
            e.target.reset();
            showNotification('Rekod prestasi berjaya disimpan!', 'success');
            
            // Create system update
            createSystemUpdate('prestasi', 'Rekod Prestasi Baharu', `${record.nama} - ${record.keputusan}`, record);
        }

        function handleDisiplinSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: formData.get('disiplin-tarikh'),
                nama: formData.get('disiplin-nama'),
                noKad: formData.get('disiplin-no-kad'),
                laporanGuru: formData.get('disiplin-laporan-guru'),
                jenis: formData.get('disiplin-jenis'),
                keterangan: formData.get('disiplin-keterangan'),
                tindakanGuru: formData.get('disiplin-tindakan-guru'),
                tindakanSekolah: formData.get('disiplin-tindakan-sekolah') || 'Tiada',
                guru: formData.get('disiplin-guru')
            };
            
            disiplinRecords.unshift(record);
            updateDisiplinTable();
            e.target.reset();
            showNotification('Rekod disiplin berjaya disimpan!', 'success');
            
            // Create system update
            const kesalahanType = record.kesalahanKecil || record.kesalahanSederhana || record.kesalahanBesar || 'Kes Disiplin';
            createSystemUpdate('disiplin', 'Rekod Disiplin Baharu', `${record.nama} - ${kesalahanType}`, record);
        }

        function handlePencapaianSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: formData.get('pencapaian-tarikh'),
                nama: formData.get('pencapaian-nama'),
                noKad: formData.get('pencapaian-no-kad'),
                jenis: formData.get('pencapaian-jenis'),
                keterangan: formData.get('pencapaian-keterangan'),
                hadiah: formData.get('pencapaian-hadiah') || '-',
                pemberi: formData.get('pencapaian-pemberi')
            };
            
            pencapaianRecords.unshift(record);
            updatePencapaianTable();
            e.target.reset();
            showNotification('Rekod pengiktirafan berjaya disimpan!', 'success');
            
            // Create system update
            createSystemUpdate('pencapaian', 'Pengiktirafan Baharu', `${record.nama} - ${record.jenis}`, record);
        }

        function handleAktivitiSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: formData.get('aktiviti-tarikh'),
                nama: formData.get('aktiviti-nama'),
                jenis: formData.get('aktiviti-jenis'),
                keterangan: formData.get('aktiviti-keterangan'),
                penyertaan: formData.get('aktiviti-penyertaan'),
                guru: formData.get('aktiviti-guru')
            };
            
            aktivitiRecords.unshift(record);
            updateAktivitiTable();
            e.target.reset();
            showNotification('Rekod aktiviti berjaya disimpan!', 'success');
            
            // Create system update
            createSystemUpdate('aktiviti', 'Rekod Aktiviti Baharu', `${record.nama} - ${record.jenis}`, record);
        }

        function handlePelajarSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                namaPenuh: formData.get('pelajar-nama-penuh'),
                ic: formData.get('pelajar-ic'),
                tarikhLahir: formData.get('pelajar-tarikh-lahir'),
                jantina: formData.get('pelajar-jantina'),
                kelas: formData.get('pelajar-kelas-semasa'),
                tarikhMasuk: formData.get('pelajar-tarikh-masuk'),
                alamat: formData.get('pelajar-alamat'),
                namaWali: formData.get('pelajar-nama-wali'),
                telefonWali: formData.get('pelajar-telefon-wali'),
                icWali: formData.get('pelajar-ic-wali'),
                pekerjaanWali: formData.get('pelajar-pekerjaan-wali'),
                pendapatanWali: formData.get('pelajar-pendapatan-wali'),
                alamatWali: formData.get('pelajar-alamat-wali'),
                waliKecemasan: formData.get('pelajar-wali-kecemasan'),
                telefonKecemasan: formData.get('pelajar-telefon-kecemasan'),
                hubunganKecemasan: formData.get('pelajar-hubungan-kecemasan'),
                status: formData.get('pelajar-status')
            };
            
            pelajarRecords.unshift(record);
            updatePelajarTable();
            e.target.reset();
            showNotification('Data pelajar berjaya disimpan!', 'success');
            
            // Create system update
            createSystemUpdate('pelajar', 'Data Pelajar Baharu', `${record.namaPenuh} - ${record.kelas}`, record);
        }

        function createAutoPrestasiRecord(hafazanRecord) {
            // Map hafazan results to prestasi grades
            const resultMapping = {
                'lancar': 'cemerlang',
                'kurang-lancar': 'baik',
                'tidak-lancar': 'memuaskan',
                'tidak-sampai-target': 'sederhana',
                'gagal': 'lemah',
                'mengulang': 'lemah'
            };
            
            const prestasiRecord = {
                id: Date.now() + 1,
                tarikh: hafazanRecord.tarikh,
                hari: new Date().toLocaleDateString('ms-MY', { weekday: 'long' }),
                nama: hafazanRecord.nama,
                surah: hafazanRecord.surah,
                keputusan: resultMapping[hafazanRecord.keputusan] || 'sederhana',
                catatan: `Auto-generated dari rekod hafazan: ${hafazanRecord.jenisHafalan}`
            };
            
            prestasiRecords.unshift(prestasiRecord);
        }

        // Settings Functions
        function saveGeneralSettings() {
            systemSettings.institutionName = document.getElementById('nama-institusi').value;
            systemSettings.institutionAddress = document.getElementById('alamat-institusi').value;
            systemSettings.institutionPhone = document.getElementById('telefon-institusi').value;
            
            // Update header
            document.querySelector('header h1').textContent = `Sistem Pentadbiran ${systemSettings.institutionName}`;
            
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            showNotification('Tetapan umum berjaya disimpan!', 'success');
        }

        // Print & Export Functions
        function printReport(type) {
            let data, title, headers;
            
            switch(type) {
                case 'hafazan':
                    data = hafazanRecords;
                    title = 'Laporan Rekod Hafazan';
                    headers = ['Tarikh', 'Nama Pelajar', 'Kelas', 'Jenis Hafalan', 'Surah', 'Keputusan', 'Ustaz'];
                    break;
                case 'prestasi':
                    data = prestasiRecords;
                    title = 'Laporan Prestasi Harian';
                    headers = ['Tarikh', 'Hari', 'Nama Pelajar', 'Surah/Aktiviti', 'Prestasi', 'Catatan'];
                    break;
                case 'disiplin':
                    data = disiplinRecords;
                    title = 'Laporan Rekod Disiplin';
                    headers = ['Tarikh', 'Nama Pelajar', 'Jenis Kes', 'Keterangan', 'Tindakan', 'Guru'];
                    break;
            }
            
            if (!data || data.length === 0) {
                showNotification('Tiada data untuk dicetak', 'warning');
                return;
            }
            
            generatePrintContent(title, headers, data, type);
            window.print();
        }

        function generatePrintContent(title, headers, data, type) {
            const printArea = document.getElementById('print-area');
            const currentDate = new Date().toLocaleDateString('ms-MY', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            let tableRows = '';
            data.forEach((record, index) => {
                let row = '<tr>';
                switch(type) {
                    case 'hafazan':
                        row += `<td>${record.tarikh}</td>`;
                        row += `<td>${record.nama}</td>`;
                        row += `<td>${record.kelas}</td>`;
                        row += `<td>${record.jenisHafalan}</td>`;
                        row += `<td>${record.surah}</td>`;
                        row += `<td>${record.keputusan}</td>`;
                        row += `<td>${record.ustaz}</td>`;
                        break;
                    case 'prestasi':
                        row += `<td>${record.tarikh}</td>`;
                        row += `<td>${record.hari}</td>`;
                        row += `<td>${record.nama}</td>`;
                        row += `<td>${record.surah}</td>`;
                        row += `<td>${record.keputusan}</td>`;
                        row += `<td>${record.catatan}</td>`;
                        break;
                    case 'disiplin':
                        row += `<td>${record.tarikh}</td>`;
                        row += `<td>${record.nama}</td>`;
                        row += `<td>${record.jenis}</td>`;
                        row += `<td>${record.keterangan}</td>`;
                        row += `<td>${record.tindakan}</td>`;
                        row += `<td>${record.guru}</td>`;
                        break;
                }
                row += '</tr>';
                tableRows += row;
            });
            
            const headerCells = headers.map(header => `<th>${header}</th>`).join('');
            
            printArea.innerHTML = `
                <div class="print-header">
                    <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">${systemSettings.institutionName}</h1>
                    <p style="margin-bottom: 5px;">${systemSettings.institutionAddress}</p>
                    <p style="margin-bottom: 20px;">Tel: ${systemSettings.institutionPhone}</p>
                    <h2 style="font-size: 20px; font-weight: bold;">${title}</h2>
                    <p style="margin-top: 10px;">Tarikh Cetak: ${currentDate}</p>
                </div>
                
                <table class="print-table">
                    <thead>
                        <tr>${headerCells}</tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
                
                <div class="print-footer">
                    <p>Jumlah Rekod: ${data.length}</p>
                    <p style="margin-top: 20px;">_________________________</p>
                    <p>Tandatangan Pentadbir</p>
                </div>
            `;
            
            printArea.classList.remove('hidden');
            
            // Hide print area after printing
            setTimeout(() => {
                printArea.classList.add('hidden');
            }, 1000);
        }

        function exportToExcel(type) {
            let data, filename;
            
            switch(type) {
                case 'hafazan':
                    data = hafazanRecords.map(record => ({
                        'Tarikh': record.tarikh,
                        'Nama Pelajar': record.nama,
                        'Kelas': record.kelas,
                        'Jenis Hafalan': record.jenisHafalan,
                        'Surah': record.surah,
                        'Keputusan': record.keputusan,
                        'Ustaz': record.ustaz
                    }));
                    filename = 'Rekod_Hafazan';
                    break;
                case 'prestasi':
                    data = prestasiRecords.map(record => ({
                        'Tarikh': record.tarikh,
                        'Hari': record.hari,
                        'Nama Pelajar': record.nama,
                        'Surah/Aktiviti': record.surah,
                        'Prestasi': record.keputusan,
                        'Catatan': record.catatan
                    }));
                    filename = 'Rekod_Prestasi';
                    break;
                case 'disiplin':
                    data = disiplinRecords.map(record => ({
                        'Tarikh': record.tarikh,
                        'Nama Pelajar': record.nama,
                        'Jenis Kes': record.jenis,
                        'Keterangan': record.keterangan,
                        'Tindakan': record.tindakan,
                        'Guru': record.guru
                    }));
                    filename = 'Rekod_Disiplin';
                    break;
            }
            
            if (!data || data.length === 0) {
                showNotification('Tiada data untuk diexport', 'warning');
                return;
            }
            
            // Convert to CSV format
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header] || ''}"`).join(','))
            ].join('\n');
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${filename}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`Fail ${filename} berjaya dimuat turun!`, 'success');
        }

        function previewLogo(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logo-preview');
                    const img = document.getElementById('logo-preview-img');
                    img.src = e.target.result;
                    preview.classList.remove('hidden');
                    systemSettings.logoUrl = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function previewWallpaper(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('wallpaper-preview');
                    const img = document.getElementById('wallpaper-preview-img');
                    img.src = e.target.result;
                    preview.classList.remove('hidden');
                    systemSettings.wallpaperUrl = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveAppearanceSettings() {
            // Apply logo
            if (systemSettings.logoUrl) {
                const logoContainers = document.querySelectorAll('#logo-container, #dashboard-logo');
                logoContainers.forEach(container => {
                    container.innerHTML = `<img src="${systemSettings.logoUrl}" alt="Logo" class="w-full h-full object-contain rounded-full">`;
                });
            }
            
            // Apply wallpaper
            if (systemSettings.wallpaperUrl) {
                document.body.style.backgroundImage = `url(${systemSettings.wallpaperUrl})`;
                document.body.classList.add('custom-wallpaper');
                
                // Add overlay for better readability
                const overlay = document.createElement('div');
                overlay.className = 'wallpaper-overlay fixed inset-0 pointer-events-none';
                document.body.appendChild(overlay);
            }
            
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            showNotification('Tetapan penampilan berjaya disimpan!', 'success');
        }

        function resetAppearance() {
            systemSettings.logoUrl = '';
            systemSettings.wallpaperUrl = '';
            
            // Reset logo
            const logoContainers = document.querySelectorAll('#logo-container, #dashboard-logo');
            logoContainers.forEach(container => {
                container.innerHTML = '<div class="w-20 h-20 bg-gradient-to-br from-green-400 to-blue-500 rounded-full mx-auto flex items-center justify-center"><span class="text-white text-2xl font-bold">MT</span></div>';
            });
            
            // Reset wallpaper
            document.body.style.backgroundImage = '';
            document.body.classList.remove('custom-wallpaper');
            
            // Remove overlay
            const overlay = document.querySelector('.wallpaper-overlay');
            if (overlay) overlay.remove();
            
            // Clear previews
            document.getElementById('logo-preview').classList.add('hidden');
            document.getElementById('wallpaper-preview').classList.add('hidden');
            document.getElementById('upload-logo').value = '';
            document.getElementById('upload-wallpaper').value = '';
            
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            showNotification('Penampilan telah dikembalikan kepada default', 'info');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            
            const bgColor = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            }[type] || 'bg-blue-500';
            
            notification.className = `notification ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function initializeSampleData() {
            // Add some sample data
            hafazanRecords = [
                {
                    id: 1,
                    tarikh: '15/12/2024',
                    nama: 'Ahmad Zaki',
                    kelas: 'Mumtaz',
                    jenisHafalan: 'Sabaq',
                    surah: 'Al-Baqarah',
                    keputusan: 'Lancar',
                    ustaz: 'Ustaz Mahmud'
                }
            ];
            
            prestasiRecords = [
                {
                    id: 1,
                    tarikh: '15/12/2024',
                    hari: 'Ahad',
                    nama: 'Ahmad Zaki',
                    surah: 'Al-Baqarah',
                    keputusan: 'Cemerlang',
                    catatan: 'Auto-generated dari rekod hafazan'
                }
            ];
            
            disiplinRecords = [];
            pencapaianRecords = [];
            aktivitiRecords = [];
            pelajarRecords = [];
        }

        function updateAllTables() {
            updateHafazanTable();
            updatePrestasiTable();
            updateDisiplinTable();
            updatePencapaianTable();
            updateAktivitiTable();
            updatePelajarTable();
        }

        function updateHafazanTable() {
            const tbody = document.getElementById('hafazan-records');
            tbody.innerHTML = '';
            
            hafazanRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.tarikh}</td>
                    <td class="px-4 py-2 text-sm">${record.nama}</td>
                    <td class="px-4 py-2 text-sm">${record.kelas}</td>
                    <td class="px-4 py-2 text-sm">${record.jenisHafalan}</td>
                    <td class="px-4 py-2 text-sm">${record.surah}</td>
                    <td class="px-4 py-2 text-sm">${record.keputusan}</td>
                    <td class="px-4 py-2 text-sm">${record.kehadiran}</td>
                    <td class="px-4 py-2 text-sm">${record.ustaz}</td>
                    <td class="px-4 py-2 text-sm">${record.catatan}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePrestasiTable(records = prestasiRecords) {
            const tbody = document.getElementById('prestasi-records');
            tbody.innerHTML = '';
            
            records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.tarikh}</td>
                    <td class="px-4 py-2 text-sm">${record.hari}</td>
                    <td class="px-4 py-2 text-sm">${record.nama}</td>
                    <td class="px-4 py-2 text-sm">${record.surah}</td>
                    <td class="px-4 py-2 text-sm">${record.keputusan}</td>
                    <td class="px-4 py-2 text-sm">${record.catatan}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateDisiplinTable(records = disiplinRecords) {
            const tbody = document.getElementById('disiplin-records');
            tbody.innerHTML = '';
            
            records.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.tarikh}</td>
                    <td class="px-4 py-2 text-sm">${record.nama}</td>
                    <td class="px-4 py-2 text-sm">${record.laporanGuru}</td>
                    <td class="px-4 py-2 text-sm">${record.jenis}</td>
                    <td class="px-4 py-2 text-sm">${record.keterangan}</td>
                    <td class="px-4 py-2 text-sm">${record.tindakanGuru}</td>
                    <td class="px-4 py-2 text-sm">${record.tindakanSekolah}</td>
                    <td class="px-4 py-2 text-sm">${record.guru}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePencapaianTable() {
            const tbody = document.getElementById('pencapaian-records');
            tbody.innerHTML = '';
            
            pencapaianRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.tarikh}</td>
                    <td class="px-4 py-2 text-sm">${record.nama}</td>
                    <td class="px-4 py-2 text-sm">${record.jenis}</td>
                    <td class="px-4 py-2 text-sm">${record.keterangan}</td>
                    <td class="px-4 py-2 text-sm">${record.hadiah}</td>
                    <td class="px-4 py-2 text-sm">${record.pemberi}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateAktivitiTable() {
            const tbody = document.getElementById('aktiviti-records');
            tbody.innerHTML = '';
            
            aktivitiRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.tarikh}</td>
                    <td class="px-4 py-2 text-sm">${record.nama}</td>
                    <td class="px-4 py-2 text-sm">${record.jenis}</td>
                    <td class="px-4 py-2 text-sm">${record.keterangan}</td>
                    <td class="px-4 py-2 text-sm">${record.penyertaan}</td>
                    <td class="px-4 py-2 text-sm">${record.guru}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePelajarTable() {
            const tbody = document.getElementById('pelajar-records');
            tbody.innerHTML = '';
            
            pelajarRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${record.namaPenuh}</td>
                    <td class="px-4 py-2 text-sm">${record.ic}</td>
                    <td class="px-4 py-2 text-sm">${record.kelas}</td>
                    <td class="px-4 py-2 text-sm">${record.tarikhMasuk}</td>
                    <td class="px-4 py-2 text-sm">${record.namaWali}</td>
                    <td class="px-4 py-2 text-sm">${record.status}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadSystemSettings() {
            const saved = localStorage.getItem('systemSettings');
            if (saved) {
                systemSettings = { ...systemSettings, ...JSON.parse(saved) };
            }
        }

        // Backup functions (simplified for demo)
        function createManualBackup() {
            showNotification('Backup manual sedang dibuat...', 'info');
            setTimeout(() => {
                lastBackupTime = new Date();
                document.getElementById('last-backup-time').textContent = lastBackupTime.toLocaleString('ms-MY');
                showNotification('Backup berjaya dibuat!', 'success');
            }, 2000);
        }

        function downloadBackup() {
            const backupData = {
                hafazanRecords,
                prestasiRecords,
                disiplinRecords,
                pencapaianRecords,
                aktivitiRecords,
                pelajarRecords,
                systemSettings,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_mahad_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Backup berjaya dimuat turun!', 'success');
        }

        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('Sila pilih fail backup untuk restore', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Restore data
                    hafazanRecords = backupData.hafazanRecords || [];
                    prestasiRecords = backupData.prestasiRecords || [];
                    disiplinRecords = backupData.disiplinRecords || [];
                    pencapaianRecords = backupData.pencapaianRecords || [];
                    aktivitiRecords = backupData.aktivitiRecords || [];
                    pelajarRecords = backupData.pelajarRecords || [];
                    
                    if (backupData.systemSettings) {
                        systemSettings = { ...systemSettings, ...backupData.systemSettings };
                    }
                    
                    // Update all tables
                    updateAllTables();
                    
                    showNotification('Data berjaya dipulihkan dari backup!', 'success');
                } catch (error) {
                    showNotification('Fail backup tidak sah atau rosak', 'error');
                }
            };
            reader.readAsText(file);
        }

        function toggleAutoBackup() {
            const toggle = document.getElementById('auto-backup-toggle');
            systemSettings.autoBackup = toggle.checked;
            document.getElementById('backup-status').textContent = toggle.checked ? 'Aktif' : 'Tidak Aktif';
            showNotification(`Auto backup ${toggle.checked ? 'diaktifkan' : 'dinyahaktifkan'}`, 'info');
        }

        function updateBackupInterval() {
            const interval = document.getElementById('backup-interval').value;
            systemSettings.backupInterval = parseInt(interval);
            showNotification(`Selang backup dikemaskini kepada ${interval} jam`, 'info');
        }

        // Search and Filter Functions
        function applyPrestasiFilter() {
            const searchTerm = document.getElementById('search-prestasi').value.toLowerCase();
            const filterKeputusan = document.getElementById('filter-prestasi-keputusan').value;
            const filterTarikh = document.getElementById('filter-prestasi-tarikh').value;
            
            let filteredRecords = prestasiRecords;
            
            if (searchTerm) {
                filteredRecords = filteredRecords.filter(record => 
                    record.nama.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filterKeputusan) {
                filteredRecords = filteredRecords.filter(record => 
                    record.keputusan === filterKeputusan
                );
            }
            
            if (filterTarikh) {
                filteredRecords = filteredRecords.filter(record => 
                    record.tarikh === new Date(filterTarikh).toLocaleDateString('ms-MY')
                );
            }
            
            updatePrestasiTable(filteredRecords);
            showNotification(`Menunjukkan ${filteredRecords.length} rekod prestasi`, 'info');
        }

        function resetPrestasiFilter() {
            document.getElementById('search-prestasi').value = '';
            document.getElementById('filter-prestasi-keputusan').value = '';
            document.getElementById('filter-prestasi-tarikh').value = '';
            updatePrestasiTable();
            showNotification('Penapis prestasi telah direset', 'info');
        }

        function applyDisiplinFilter() {
            const searchTerm = document.getElementById('search-disiplin').value.toLowerCase();
            const filterJenis = document.getElementById('filter-disiplin-jenis').value;
            const filterTarikh = document.getElementById('filter-disiplin-tarikh').value;
            
            let filteredRecords = disiplinRecords;
            
            if (searchTerm) {
                filteredRecords = filteredRecords.filter(record => 
                    record.nama.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filterJenis) {
                filteredRecords = filteredRecords.filter(record => 
                    record.jenis === filterJenis
                );
            }
            
            if (filterTarikh) {
                filteredRecords = filteredRecords.filter(record => 
                    record.tarikh === filterTarikh
                );
            }
            
            updateDisiplinTable(filteredRecords);
            showNotification(`Menunjukkan ${filteredRecords.length} rekod disiplin`, 'info');
        }

        function resetDisiplinFilter() {
            document.getElementById('search-disiplin').value = '';
            document.getElementById('filter-disiplin-jenis').value = '';
            document.getElementById('filter-disiplin-tarikh').value = '';
            updateDisiplinTable();
            showNotification('Penapis disiplin telah direset', 'info');
        }

        // Activity Types Management Functions
        function addActivityType() {
            const input = document.getElementById('new-activity-type');
            const activityName = input.value.trim();
            
            if (!activityName) {
                showNotification('Sila masukkan nama jenis aktiviti', 'warning');
                return;
            }
            
            // Check if activity type already exists
            const exists = activityTypes.some(type => 
                type.label.toLowerCase() === activityName.toLowerCase()
            );
            
            if (exists) {
                showNotification('Jenis aktiviti ini sudah wujud', 'warning');
                return;
            }
            
            // Add new activity type
            const newId = Math.max(...activityTypes.map(t => t.id)) + 1;
            const newActivityType = {
                id: newId,
                name: activityName.toLowerCase().replace(/\s+/g, '-'),
                label: activityName,
                default: false
            };
            
            activityTypes.push(newActivityType);
            
            // Update displays
            updateActivityTypesList();
            updateActivityTypesDropdown();
            
            // Clear input
            input.value = '';
            
            showNotification(`Jenis aktiviti "${activityName}" berjaya ditambah!`, 'success');
        }
        
        function removeActivityType(id) {
            const activityType = activityTypes.find(type => type.id === id);
            
            if (activityType && activityType.default) {
                showNotification('Jenis aktiviti default tidak boleh dipadam', 'warning');
                return;
            }
            
            // Show confirmation
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            confirmDiv.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Pengesahan Padam</h3>
                    <p class="text-gray-600 mb-6">Adakah anda pasti mahu memadamkan jenis aktiviti "${activityType.label}"?</p>
                    <div class="flex space-x-3">
                        <button id="confirm-delete" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition duration-200">
                            Ya, Padam
                        </button>
                        <button id="cancel-delete" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmDiv);
            
            document.getElementById('confirm-delete').addEventListener('click', () => {
                activityTypes = activityTypes.filter(type => type.id !== id);
                updateActivityTypesList();
                updateActivityTypesDropdown();
                document.body.removeChild(confirmDiv);
                showNotification(`Jenis aktiviti "${activityType.label}" berjaya dipadam`, 'success');
            });
            
            document.getElementById('cancel-delete').addEventListener('click', () => {
                document.body.removeChild(confirmDiv);
            });
        }
        
        function editActivityType(id) {
            const activityType = activityTypes.find(type => type.id === id);
            
            if (!activityType) return;
            
            const editDiv = document.createElement('div');
            editDiv.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            editDiv.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Jenis Aktiviti</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Jenis Aktiviti</label>
                        <input type="text" id="edit-activity-name" value="${activityType.label}" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex space-x-3">
                        <button id="save-edit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                            Simpan
                        </button>
                        <button id="cancel-edit" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(editDiv);
            
            document.getElementById('save-edit').addEventListener('click', () => {
                const newName = document.getElementById('edit-activity-name').value.trim();
                
                if (!newName) {
                    showNotification('Sila masukkan nama jenis aktiviti', 'warning');
                    return;
                }
                
                // Check if name already exists (excluding current item)
                const exists = activityTypes.some(type => 
                    type.id !== id && type.label.toLowerCase() === newName.toLowerCase()
                );
                
                if (exists) {
                    showNotification('Nama jenis aktiviti ini sudah wujud', 'warning');
                    return;
                }
                
                // Update activity type
                activityType.label = newName;
                activityType.name = newName.toLowerCase().replace(/\s+/g, '-');
                
                updateActivityTypesList();
                updateActivityTypesDropdown();
                document.body.removeChild(editDiv);
                showNotification(`Jenis aktiviti berjaya dikemaskini kepada "${newName}"`, 'success');
            });
            
            document.getElementById('cancel-edit').addEventListener('click', () => {
                document.body.removeChild(editDiv);
            });
        }
        
        function updateActivityTypesList() {
            const container = document.getElementById('activity-types-list');
            container.innerHTML = '';
            
            activityTypes.forEach(type => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg border';
                
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-sm font-medium text-gray-800">${type.label}</span>
                        ${type.default ? '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Default</span>' : ''}
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editActivityType(${type.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                            ‚úèÔ∏è Edit
                        </button>
                        ${!type.default ? `<button onclick="removeActivityType(${type.id})" class="text-red-600 hover:text-red-800 text-sm">üóëÔ∏è Padam</button>` : ''}
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function updateActivityTypesDropdown() {
            const dropdown = document.getElementById('aktiviti-jenis');
            
            // Clear existing options except the first one
            while (dropdown.children.length > 1) {
                dropdown.removeChild(dropdown.lastChild);
            }
            
            // Add activity types as options
            activityTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type.name;
                option.textContent = type.label;
                dropdown.appendChild(option);
            });
        }
        
        function saveActivitySettings() {
            // Save activity types to localStorage
            localStorage.setItem('activityTypes', JSON.stringify(activityTypes));
            showNotification('Tetapan jenis aktiviti berjaya disimpan!', 'success');
        }
        
        function loadActivityTypes() {
            const saved = localStorage.getItem('activityTypes');
            if (saved) {
                activityTypes = JSON.parse(saved);
            }
        }

        // User Management Functions
        function addNewUser() {
            const username = document.getElementById('tambah-pengguna').value.trim();
            const password = document.getElementById('kata-laluan-baru').value.trim();
            const role = document.getElementById('peranan-pengguna').value;
            
            if (!username) {
                showNotification('Sila masukkan nama pengguna', 'warning');
                return;
            }
            
            if (!password) {
                showNotification('Sila masukkan kata laluan', 'warning');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Kata laluan mestilah sekurang-kurangnya 6 aksara', 'warning');
                return;
            }
            
            // Check if username already exists
            if (securityDatabase[username] || systemUsers.find(user => user.username === username)) {
                showNotification('Nama pengguna sudah wujud', 'error');
                return;
            }
            
            // Add to security database
            securityDatabase[username] = {
                password: password,
                securityAnswers: {
                    school: 'default',
                    mother: 'default',
                    birthplace: 'default'
                }
            };
            
            // Add to system users
            const newUser = {
                id: Date.now(),
                username: username,
                role: role,
                dateCreated: new Date().toLocaleDateString('ms-MY'),
                status: 'aktif',
                lastLogin: null,
                createdBy: currentUser.username
            };
            
            systemUsers.push(newUser);
            
            // Update user list display
            updateUsersList();
            
            // Clear form
            document.getElementById('tambah-pengguna').value = '';
            document.getElementById('kata-laluan-baru').value = '';
            document.getElementById('peranan-pengguna').value = 'admin';
            
            // Save to localStorage
            localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
            localStorage.setItem('securityDatabase', JSON.stringify(securityDatabase));
            
            showNotification(`Pengguna "${username}" berjaya ditambah dengan peranan ${role}!`, 'success');
        }
        
        function updateUsersList() {
            // Check if users list container exists, if not create it
            let usersListContainer = document.getElementById('users-list-container');
            
            if (!usersListContainer) {
                // Create users list container after the add user form
                usersListContainer = document.createElement('div');
                usersListContainer.id = 'users-list-container';
                usersListContainer.className = 'mt-6 bg-white p-4 rounded-lg border';
                usersListContainer.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-md font-medium text-gray-700">Pengurusan Pengguna Sistem</h4>
                        <div class="flex space-x-2">
                            <button id="filter-active-users" class="text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full hover:bg-green-200 transition duration-200">
                                Aktif Sahaja
                            </button>
                            <button id="filter-all-users" class="text-xs bg-gray-100 text-gray-800 px-3 py-1 rounded-full hover:bg-gray-200 transition duration-200">
                                Semua Pengguna
                            </button>
                        </div>
                    </div>
                    
                    <!-- User Statistics -->
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div class="bg-green-50 p-3 rounded-lg text-center">
                            <div class="text-lg font-bold text-green-600" id="active-users-count">0</div>
                            <div class="text-xs text-green-700">Pengguna Aktif</div>
                        </div>
                        <div class="bg-red-50 p-3 rounded-lg text-center">
                            <div class="text-lg font-bold text-red-600" id="inactive-users-count">0</div>
                            <div class="text-xs text-red-700">Tidak Aktif</div>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg text-center">
                            <div class="text-lg font-bold text-blue-600" id="total-users-count">0</div>
                            <div class="text-xs text-blue-700">Jumlah Pengguna</div>
                        </div>
                    </div>
                    
                    <div id="users-list" class="space-y-2 max-h-64 overflow-y-auto">
                        <!-- Users will be populated here -->
                    </div>
                `;
                
                // Find the user management section and append
                const addUserBtn = document.getElementById('add-user-btn');
                addUserBtn.parentNode.parentNode.appendChild(usersListContainer);
                
                // Add event listeners for filter buttons
                document.getElementById('filter-active-users').addEventListener('click', () => filterUsers('active'));
                document.getElementById('filter-all-users').addEventListener('click', () => filterUsers('all'));
            }
            
            populateUsersList('all');
        }
        
        function populateUsersList(filter = 'all') {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            
            // Update filter button states
            const activeBtn = document.getElementById('filter-active-users');
            const allBtn = document.getElementById('filter-all-users');
            
            if (filter === 'active') {
                activeBtn.classList.add('bg-green-200', 'font-semibold');
                activeBtn.classList.remove('bg-green-100');
                allBtn.classList.add('bg-gray-100');
                allBtn.classList.remove('bg-gray-200', 'font-semibold');
            } else {
                allBtn.classList.add('bg-gray-200', 'font-semibold');
                allBtn.classList.remove('bg-gray-100');
                activeBtn.classList.add('bg-green-100');
                activeBtn.classList.remove('bg-green-200', 'font-semibold');
            }
            
            let activeCount = 0;
            let inactiveCount = 0;
            let totalCount = 1; // Start with 1 for default admin
            
            // Add default admin user
            const adminItem = document.createElement('div');
            adminItem.className = 'flex items-center justify-between p-3 bg-blue-50 rounded-lg border';
            adminItem.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 bg-green-500 rounded-full" title="Status Aktif"></div>
                    <span class="text-sm font-medium text-gray-800">admin</span>
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Admin</span>
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Default</span>
                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">‚óè&nbsp;Aktif</span>
                </div>
                <div class="flex space-x-2">
                    <span class="text-xs text-gray-500">Login Terakhir: Hari ini</span>
                </div>
            `;
            usersList.appendChild(adminItem);
            activeCount++;
            
            // Add other users
            systemUsers.forEach(user => {
                const isActive = user.status === 'aktif';
                const lastLogin = user.lastLogin || 'Belum pernah';
                const daysSinceLogin = user.lastLogin ? calculateDaysSince(user.lastLogin) : null;
                
                // Auto-mark as inactive if no login for 30+ days
                if (daysSinceLogin && daysSinceLogin > 30 && user.status === 'aktif') {
                    user.status = 'tidak-aktif';
                    user.autoDeactivated = true;
                }
                
                // Apply filter
                if (filter === 'active' && user.status !== 'aktif') {
                    return;
                }
                
                totalCount++;
                if (user.status === 'aktif') {
                    activeCount++;
                } else {
                    inactiveCount++;
                }
                
                const userItem = document.createElement('div');
                const statusColor = user.status === 'aktif' ? 'bg-green-500' : 'bg-red-500';
                const bgColor = user.status === 'aktif' ? 'bg-gray-50' : 'bg-red-50';
                
                const roleColor = {
                    'admin': 'bg-red-100 text-red-800',
                    'guru': 'bg-green-100 text-green-800',
                    'pembantu': 'bg-yellow-100 text-yellow-800'
                }[user.role] || 'bg-gray-100 text-gray-800';
                
                userItem.className = `flex items-center justify-between p-3 ${bgColor} rounded-lg border`;
                
                const statusText = user.status === 'aktif' ? '‚óè&nbsp;Aktif' : '‚óè&nbsp;Tidak Aktif';
                const statusBadgeColor = user.status === 'aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                
                userItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 ${statusColor} rounded-full" title="Status ${user.status}"></div>
                        <span class="text-sm font-medium text-gray-800">${user.username}</span>
                        <span class="text-xs ${roleColor} px-2 py-1 rounded">${user.role.charAt(0).toUpperCase() + user.role.slice(1)}</span>
                        <span class="text-xs ${statusBadgeColor} px-2 py-1 rounded">${statusText}</span>
                        <span class="text-xs text-gray-500">Dibuat: ${user.dateCreated}</span>
                        ${user.autoDeactivated ? '<span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded">Auto-Nyahaktif</span>' : ''}
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="text-xs text-gray-500">
                            Login Terakhir: ${lastLogin}
                            ${daysSinceLogin ? `<br><span class="text-orange-600">(${daysSinceLogin} hari lalu)</span>` : ''}
                        </div>
                        <div class="flex space-x-1">
                            <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800 text-sm px-2 py-1 rounded hover:bg-blue-100 transition duration-200">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="resetUserPassword('${user.username}')" class="text-green-600 hover:text-green-800 text-sm px-2 py-1 rounded hover:bg-green-100 transition duration-200">
                                üîë Reset
                            </button>
                            ${user.status === 'aktif' ? 
                                `<button onclick="deactivateUser(${user.id})" class="text-orange-600 hover:text-orange-800 text-sm px-2 py-1 rounded hover:bg-orange-100 transition duration-200">
                                    ‚è∏Ô∏è Nyahaktif
                                </button>` :
                                `<button onclick="activateUser(${user.id})" class="text-green-600 hover:text-green-800 text-sm px-2 py-1 rounded hover:bg-green-100 transition duration-200">
                                    ‚ñ∂Ô∏è Aktifkan
                                </button>`
                            }
                            ${user.status !== 'aktif' ? 
                                `<button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800 text-sm px-2 py-1 rounded hover:bg-red-100 transition duration-200">
                                    üóëÔ∏è Padam
                                </button>` : ''
                            }
                        </div>
                    </div>
                `;
                
                usersList.appendChild(userItem);
            });
            
            // Update statistics
            document.getElementById('active-users-count').textContent = activeCount;
            document.getElementById('inactive-users-count').textContent = inactiveCount;
            document.getElementById('total-users-count').textContent = totalCount;
        }
        
        function resetUserPassword(username) {
            const newPassword = prompt(`Masukkan kata laluan baru untuk pengguna "${username}":`);
            
            if (!newPassword) {
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('Kata laluan mestilah sekurang-kurangnya 6 aksara', 'warning');
                return;
            }
            
            // Update password in security database
            if (securityDatabase[username]) {
                securityDatabase[username].password = newPassword;
                localStorage.setItem('securityDatabase', JSON.stringify(securityDatabase));
                showNotification(`Kata laluan untuk pengguna "${username}" berjaya dikemaskini!`, 'success');
            } else {
                showNotification('Pengguna tidak dijumpai', 'error');
            }
        }
        
        function deleteUser(userId) {
            const user = systemUsers.find(u => u.id === userId);
            
            if (!user) {
                showNotification('Pengguna tidak dijumpai', 'error');
                return;
            }
            
            if (confirm(`Adakah anda pasti mahu memadamkan pengguna "${user.username}"?`)) {
                // Remove from systemUsers array
                systemUsers = systemUsers.filter(u => u.id !== userId);
                
                // Remove from security database
                delete securityDatabase[user.username];
                
                // Update displays
                updateUsersList();
                
                // Save to localStorage
                localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
                localStorage.setItem('securityDatabase', JSON.stringify(securityDatabase));
                
                showNotification(`Pengguna "${user.username}" berjaya dipadam`, 'success');
            }
        }
        
        function loadSystemUsers() {
            const savedUsers = localStorage.getItem('systemUsers');
            const savedSecurity = localStorage.getItem('securityDatabase');
            
            if (savedUsers) {
                systemUsers = JSON.parse(savedUsers);
            }
            
            if (savedSecurity) {
                Object.assign(securityDatabase, JSON.parse(savedSecurity));
            }
        }
        
        // Helper functions for user management
        function filterUsers(type) {
            populateUsersList(type);
        }
        
        function calculateDaysSince(dateString) {
            const lastDate = new Date(dateString);
            const today = new Date();
            const diffTime = Math.abs(today - lastDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }
        
        function editUser(userId) {
            const user = systemUsers.find(u => u.id === userId);
            
            if (!user) {
                showNotification('Pengguna tidak dijumpai', 'error');
                return;
            }
            
            const editModal = document.createElement('div');
            editModal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            editModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Edit Pengguna: ${user.username}</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Pengguna</label>
                            <input type="text" id="edit-username" value="${user.username}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Peranan</label>
                            <select id="edit-role" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>
                                <option value="guru" ${user.role === 'guru' ? 'selected' : ''}>Guru</option>
                                <option value="pembantu" ${user.role === 'pembantu' ? 'selected' : ''}>Pembantu</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="edit-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="aktif" ${user.status === 'aktif' ? 'selected' : ''}>Aktif</option>
                                <option value="tidak-aktif" ${user.status === 'tidak-aktif' ? 'selected' : ''}>Tidak Aktif</option>
                            </select>
                        </div>
                        
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Maklumat Tambahan</h4>
                            <div class="text-xs text-gray-600 space-y-1">
                                <p><strong>Tarikh Dibuat:</strong> ${user.dateCreated}</p>
                                <p><strong>Login Terakhir:</strong> ${user.lastLogin || 'Belum pernah'}</p>
                                <p><strong>ID Pengguna:</strong> ${user.id}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3 mt-6">
                        <button id="save-user-edit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                            Simpan Perubahan
                        </button>
                        <button id="cancel-user-edit" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(editModal);
            
            document.getElementById('save-user-edit').addEventListener('click', () => {
                const newUsername = document.getElementById('edit-username').value.trim();
                const newRole = document.getElementById('edit-role').value;
                const newStatus = document.getElementById('edit-status').value;
                
                if (!newUsername) {
                    showNotification('Nama pengguna tidak boleh kosong', 'warning');
                    return;
                }
                
                // Check if username already exists (excluding current user)
                const usernameExists = systemUsers.some(u => 
                    u.id !== userId && u.username.toLowerCase() === newUsername.toLowerCase()
                ) || (newUsername.toLowerCase() === 'admin' && user.username !== 'admin');
                
                if (usernameExists) {
                    showNotification('Nama pengguna sudah wujud', 'error');
                    return;
                }
                
                // Update user data
                const oldUsername = user.username;
                user.username = newUsername;
                user.role = newRole;
                user.status = newStatus;
                user.lastModified = new Date().toLocaleDateString('ms-MY');
                
                // Update security database if username changed
                if (oldUsername !== newUsername && securityDatabase[oldUsername]) {
                    securityDatabase[newUsername] = securityDatabase[oldUsername];
                    delete securityDatabase[oldUsername];
                }
                
                // Save changes
                localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
                localStorage.setItem('securityDatabase', JSON.stringify(securityDatabase));
                
                // Update display
                updateUsersList();
                document.body.removeChild(editModal);
                
                showNotification(`Pengguna "${newUsername}" berjaya dikemaskini!`, 'success');
            });
            
            document.getElementById('cancel-user-edit').addEventListener('click', () => {
                document.body.removeChild(editModal);
            });
        }
        
        function deactivateUser(userId) {
            const user = systemUsers.find(u => u.id === userId);
            
            if (!user) {
                showNotification('Pengguna tidak dijumpai', 'error');
                return;
            }
            
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50';
            confirmModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Nyahaktifkan Pengguna</h3>
                    <p class="text-gray-600 mb-6">
                        Adakah anda pasti mahu menyahaktifkan pengguna "<strong>${user.username}</strong>"?
                        <br><br>
                        <span class="text-sm text-orange-600">
                            ‚ö†Ô∏è Pengguna ini tidak akan dapat log masuk selepas dinyahaktifkan.
                        </span>
                    </p>
                    <div class="flex space-x-3">
                        <button id="confirm-deactivate" class="flex-1 bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 transition duration-200">
                            Ya, Nyahaktifkan
                        </button>
                        <button id="cancel-deactivate" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition duration-200">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
            
            document.getElementById('confirm-deactivate').addEventListener('click', () => {
                user.status = 'tidak-aktif';
                user.deactivatedDate = new Date().toLocaleDateString('ms-MY');
                user.deactivatedBy = currentUser.username;
                
                localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
                updateUsersList();
                document.body.removeChild(confirmModal);
                
                showNotification(`Pengguna "${user.username}" telah dinyahaktifkan`, 'success');
            });
            
            document.getElementById('cancel-deactivate').addEventListener('click', () => {
                document.body.removeChild(confirmModal);
            });
        }
        
        function activateUser(userId) {
            const user = systemUsers.find(u => u.id === userId);
            
            if (!user) {
                showNotification('Pengguna tidak dijumpai', 'error');
                return;
            }
            
            user.status = 'aktif';
            user.reactivatedDate = new Date().toLocaleDateString('ms-MY');
            user.reactivatedBy = currentUser.username;
            user.autoDeactivated = false;
            
            localStorage.setItem('systemUsers', JSON.stringify(systemUsers));
            updateUsersList();
            
            showNotification(`Pengguna "${user.username}" telah diaktifkan semula`, 'success');
        }

        // ===== UPDATE SYSTEM FUNCTIONS =====
        
        function createSystemUpdate(type, title, description, data = null) {
            if (!systemSettings.autoUpdates) return;
            
            const update = {
                id: Date.now(),
                type: type,
                title: title,
                description: description,
                data: data,
                timestamp: new Date().toISOString(),
                user: currentUser ? currentUser.username : 'System',
                read: false,
                priority: getPriorityByType(type)
            };
            
            systemUpdates.unshift(update);
            
            // Clean old updates based on retention settings
            cleanOldUpdates();
            
            // Update displays
            updateUpdatesDisplay();
            
            // Show notification if enabled
            if (systemSettings.updateNotifications) {
                showUpdateNotification(update);
            }
            
            // Save to localStorage
            saveSystemUpdates();
            
            // Play sound if enabled
            if (document.getElementById('enable-sound-notifications')?.checked) {
                playNotificationSound();
            }
        }
        
        function getPriorityByType(type) {
            const priorities = {
                'disiplin': 'high',
                'pelajar': 'high',
                'hafazan': 'medium',
                'prestasi': 'medium',
                'pencapaian': 'low',
                'aktiviti': 'low'
            };
            return priorities[type] || 'medium';
        }
        
        function showUpdateNotification(update) {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 z-50 bg-white border-l-4 ${getPriorityColor(update.priority)} rounded-lg shadow-lg p-4 max-w-sm transform translate-x-full transition-transform duration-300`;
            
            const icon = getTypeIcon(update.type);
            
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">${icon}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <h4 class="text-sm font-semibold text-gray-800">${update.title}</h4>
                            <button onclick="this.parentElement.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-600 mt-1">${update.description}</p>
                        <p class="text-xs text-gray-500 mt-2">Oleh: ${update.user}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }
        
        function getPriorityColor(priority) {
            const colors = {
                'high': 'border-red-500',
                'medium': 'border-yellow-500',
                'low': 'border-green-500'
            };
            return colors[priority] || 'border-blue-500';
        }
        
        function getTypeIcon(type) {
            const icons = {
                'hafazan': 'üìñ',
                'prestasi': '‚≠ê',
                'disiplin': '‚ö†Ô∏è',
                'pencapaian': 'üèÜ',
                'aktiviti': 'üéØ',
                'pelajar': 'üë§'
            };
            return icons[type] || 'üìù';
        }
        
        function playNotificationSound() {
            // Create a simple beep sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function toggleUpdatesDropdown() {
            const dropdown = document.getElementById('updates-dropdown');
            dropdown.classList.toggle('hidden');
            
            if (!dropdown.classList.contains('hidden')) {
                // Mark updates as read when dropdown is opened
                setTimeout(() => {
                    markVisibleUpdatesAsRead();
                }, 1000);
            }
        }
        
        function handleOutsideClick(event) {
            const updatesBtn = document.getElementById('updates-btn');
            const updatesDropdown = document.getElementById('updates-dropdown');
            
            if (!updatesBtn.contains(event.target) && !updatesDropdown.contains(event.target)) {
                updatesDropdown.classList.add('hidden');
            }
        }
        
        function markVisibleUpdatesAsRead() {
            let hasChanges = false;
            systemUpdates.forEach(update => {
                if (!update.read) {
                    update.read = true;
                    hasChanges = true;
                }
            });
            
            if (hasChanges) {
                updateUpdatesDisplay();
                saveSystemUpdates();
            }
        }
        
        function markAllUpdatesRead() {
            systemUpdates.forEach(update => update.read = true);
            updateUpdatesDisplay();
            saveSystemUpdates();
            showNotification('Semua kemaskini telah ditandai sebagai dibaca', 'info');
        }
        
        function clearAllUpdates() {
            if (confirm('Adakah anda pasti mahu memadamkan semua kemaskini?')) {
                systemUpdates = [];
                updateUpdatesDisplay();
                saveSystemUpdates();
                showNotification('Semua kemaskini telah dipadamkan', 'info');
            }
        }
        
        function updateUpdatesDisplay() {
            const badge = document.getElementById('updates-badge');
            const updatesList = document.getElementById('updates-list');
            const totalCount = document.getElementById('total-updates-count');
            const unreadCount = document.getElementById('unread-updates-count');
            
            // Count unread updates
            unreadUpdates = systemUpdates.filter(update => !update.read).length;
            
            // Update badge
            if (unreadUpdates > 0) {
                badge.textContent = unreadUpdates > 99 ? '99+' : unreadUpdates;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
            
            // Update counts
            totalCount.textContent = `${systemUpdates.length} kemaskini`;
            unreadCount.textContent = `${unreadUpdates} belum dibaca`;
            
            // Update list
            updatesList.innerHTML = '';
            
            if (systemUpdates.length === 0) {
                updatesList.innerHTML = `
                    <div class="p-4 text-center text-gray-500 text-sm">
                        Tiada kemaskini baharu
                    </div>
                `;
                return;
            }
            
            systemUpdates.slice(0, 20).forEach(update => {
                const updateItem = document.createElement('div');
                const isUnread = !update.read;
                const timeAgo = getTimeAgo(update.timestamp);
                const icon = getTypeIcon(update.type);
                
                updateItem.className = `p-3 border-b hover:bg-gray-50 transition duration-200 ${isUnread ? 'bg-blue-50 border-l-4 border-l-blue-500' : ''}`;
                
                updateItem.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <span class="text-lg">${icon}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                                <h4 class="text-sm font-medium text-gray-800 ${isUnread ? 'font-semibold' : ''}">${update.title}</h4>
                                <span class="text-xs text-gray-500">${timeAgo}</span>
                            </div>
                            <p class="text-xs text-gray-600 mt-1">${update.description}</p>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-xs text-gray-500">Oleh: ${update.user}</span>
                                <div class="flex space-x-2">
                                    <span class="text-xs px-2 py-1 rounded ${getTypeBadgeColor(update.type)}">${getTypeLabel(update.type)}</span>
                                    ${isUnread ? '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Baharu</span>' : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                updatesList.appendChild(updateItem);
            });
            
            // Update statistics in settings
            updateUpdateStatistics();
        }
        
        function getTimeAgo(timestamp) {
            const now = new Date();
            const updateTime = new Date(timestamp);
            const diffMs = now - updateTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Baru sahaja';
            if (diffMins < 60) return `${diffMins} minit lalu`;
            if (diffHours < 24) return `${diffHours} jam lalu`;
            if (diffDays < 7) return `${diffDays} hari lalu`;
            return updateTime.toLocaleDateString('ms-MY');
        }
        
        function getTypeBadgeColor(type) {
            const colors = {
                'hafazan': 'bg-green-100 text-green-800',
                'prestasi': 'bg-blue-100 text-blue-800',
                'disiplin': 'bg-red-100 text-red-800',
                'pencapaian': 'bg-yellow-100 text-yellow-800',
                'aktiviti': 'bg-purple-100 text-purple-800',
                'pelajar': 'bg-indigo-100 text-indigo-800'
            };
            return colors[type] || 'bg-gray-100 text-gray-800';
        }
        
        function getTypeLabel(type) {
            const labels = {
                'hafazan': 'Hafazan',
                'prestasi': 'Prestasi',
                'disiplin': 'Disiplin',
                'pencapaian': 'Pencapaian',
                'aktiviti': 'Aktiviti',
                'pelajar': 'Pelajar'
            };
            return labels[type] || type;
        }
        
        function updateUpdateStatistics() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            
            const todayCount = systemUpdates.filter(update => {
                const updateDate = new Date(update.timestamp);
                return updateDate >= today;
            }).length;
            
            const weekCount = systemUpdates.filter(update => {
                const updateDate = new Date(update.timestamp);
                return updateDate >= weekStart;
            }).length;
            
            const monthCount = systemUpdates.filter(update => {
                const updateDate = new Date(update.timestamp);
                return updateDate >= monthStart;
            }).length;
            
            document.getElementById('updates-today-count').textContent = todayCount;
            document.getElementById('updates-week-count').textContent = weekCount;
            document.getElementById('updates-month-count').textContent = monthCount;
            document.getElementById('updates-total-count').textContent = systemUpdates.length;
        }
        
        function cleanOldUpdates() {
            const retentionDays = parseInt(document.getElementById('update-retention-days')?.value || 30);
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
            
            systemUpdates = systemUpdates.filter(update => {
                const updateDate = new Date(update.timestamp);
                return updateDate >= cutoffDate;
            });
        }
        
        function saveSystemUpdates() {
            localStorage.setItem('systemUpdates', JSON.stringify(systemUpdates));
        }
        
        function loadSystemUpdates() {
            const saved = localStorage.getItem('systemUpdates');
            if (saved) {
                systemUpdates = JSON.parse(saved);
            }
        }
        
        function startUpdatePolling() {
            // Simulate real-time updates (in a real system, this would poll a server)
            setInterval(() => {
                // Clean old updates periodically
                cleanOldUpdates();
                updateUpdatesDisplay();
            }, 60000); // Every minute
        }
        
        function toggleAutoUpdatesSettings() {
            const currentStatus = systemSettings.autoUpdates;
            systemSettings.autoUpdates = !currentStatus;
            
            document.getElementById('enable-auto-updates').checked = systemSettings.autoUpdates;
            document.getElementById('auto-update-status').textContent = systemSettings.autoUpdates ? 'Aktif' : 'Tidak Aktif';
            
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            showNotification(`Kemaskini automatik ${systemSettings.autoUpdates ? 'diaktifkan' : 'dinyahaktifkan'}`, 'info');
        }
        
        function saveUpdateSettings() {
            systemSettings.autoUpdates = document.getElementById('enable-auto-updates').checked;
            systemSettings.updateNotifications = document.getElementById('enable-update-notifications').checked;
            
            const retentionDays = document.getElementById('update-retention-days').value;
            
            // Update status display
            document.getElementById('auto-update-status').textContent = systemSettings.autoUpdates ? 'Aktif' : 'Tidak Aktif';
            
            // Save settings
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            
            showNotification('Tetapan kemaskini berjaya disimpan!', 'success');
        }
        
        // ===== SUPABASE SETTINGS FUNCTIONS =====
        
        async function testSupabaseConnection() {
            const indicator = document.getElementById('supabase-status-indicator');
            const statusText = document.getElementById('supabase-status-text');
            
            indicator.className = 'w-3 h-3 bg-yellow-400 rounded-full animate-pulse';
            statusText.textContent = 'Menguji sambungan...';
            
            const connected = await checkConnection();
            
            if (connected) {
                indicator.className = 'w-3 h-3 bg-green-500 rounded-full';
                statusText.textContent = 'Sambungan berjaya!';
                showNotification('Sambungan Supabase berjaya!', 'success');
            } else {
                indicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = 'Sambungan gagal';
                showNotification('Tidak dapat sambung ke Supabase. Periksa URL dan Key.', 'error');
            }
            
            updateSupabaseStatus();
        }
        
        async function saveSupabaseSettings() {
            const newUrl = document.getElementById('supabase-url-input').value.trim();
            const newKey = document.getElementById('supabase-key-input').value.trim();
            const syncEnabled = document.getElementById('enable-supabase-sync').checked;
            const realtimeEnabled = document.getElementById('enable-realtime-updates').checked;
            
            if (!newUrl || !newKey) {
                showNotification('Sila masukkan URL dan Key Supabase', 'warning');
                return;
            }
            
            // Update settings
            systemSettings.supabaseUrl = newUrl;
            systemSettings.supabaseKey = newKey;
            systemSettings.syncEnabled = syncEnabled;
            systemSettings.realtimeEnabled = realtimeEnabled;
            
            // Save to localStorage
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            
            // Reinitialize Supabase with new settings
            showNotification('Menyambung semula dengan tetapan baharu...', 'info');
            
            try {
                // Create new Supabase client
                const newSupabase = window.supabase.createClient(newUrl, newKey);
                
                // Test connection
                const { data, error } = await newSupabase.from('system_health').select('*').limit(1);
                
                if (!error) {
                    // Update global supabase client
                    window.supabase = newSupabase;
                    isOnline = true;
                    
                    // Setup subscriptions if enabled
                    if (realtimeEnabled) {
                        setupRealtimeSubscriptions();
                    }
                    
                    showNotification('Tetapan Supabase berjaya disimpan dan disambung!', 'success');
                    updateSupabaseStatus();
                } else {
                    throw new Error(error.message);
                }
            } catch (error) {
                isOnline = false;
                showNotification(`Ralat sambungan: ${error.message}`, 'error');
                updateSupabaseStatus();
            }
        }
        
        async function forceSyncNow() {
            if (!isOnline) {
                showNotification('Tidak dapat sync - tiada sambungan ke Supabase', 'warning');
                return;
            }
            
            showNotification('Memulakan penyegerakan paksa...', 'info');
            
            try {
                // Sync all local data to Supabase
                const allData = [
                    { table: 'hafazan_records', data: hafazanRecords },
                    { table: 'prestasi_records', data: prestasiRecords },
                    { table: 'disiplin_records', data: disiplinRecords },
                    { table: 'pencapaian_records', data: pencapaianRecords },
                    { table: 'aktiviti_records', data: aktivitiRecords },
                    { table: 'pelajar_records', data: pelajarRecords }
                ];
                
                let syncCount = 0;
                let errorCount = 0;
                
                for (const { table, data } of allData) {
                    for (const record of data) {
                        const result = await syncToSupabase(table, record, 'insert');
                        if (result.success) {
                            syncCount++;
                        } else {
                            errorCount++;
                        }
                    }
                }
                
                // Process sync queue
                await processSyncQueue();
                
                showNotification(`Sync selesai: ${syncCount} berjaya, ${errorCount} ralat`, 
                    errorCount > 0 ? 'warning' : 'success');
                
                updateSupabaseStatus();
                
            } catch (error) {
                showNotification(`Ralat semasa sync: ${error.message}`, 'error');
            }
        }
        
        function showSQLSchema() {
            const sqlSchema = `
-- Supabase SQL Schema untuk Sistem Pentadbiran Mahad Tahfiz
-- Jalankan SQL ini di Supabase SQL Editor

-- Enable Row Level Security
ALTER DATABASE postgres SET "app.jwt_secret" TO 'your-jwt-secret';

-- Create tables
CREATE TABLE IF NOT EXISTS hafazan_records (
    id BIGINT PRIMARY KEY,
    tarikh TEXT,
    nama TEXT,
    no_kad TEXT,
    kelas TEXT,
    jenis_hafalan TEXT,
    surah TEXT,
    keputusan TEXT,
    kehadiran TEXT,
    ustaz TEXT,
    catatan TEXT,
    bilangan_baris TEXT,
    sabqi_sebelum TEXT,
    sabqi_akan_datang TEXT,
    ayat_awal TEXT,
    ayat_akhir TEXT,
    sasaran_baris_juzuk TEXT,
    pilihan_juzuk_muka TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS prestasi_records (
    id BIGINT PRIMARY KEY,
    tarikh TEXT,
    hari TEXT,
    nama TEXT,
    no_kad TEXT,
    surah TEXT,
    keputusan TEXT,
    catatan TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS disiplin_records (
    id BIGINT PRIMARY KEY,
    tarikh TEXT,
    nama TEXT,
    no_kad TEXT,
    laporan_guru TEXT,
    jenis TEXT,
    keterangan TEXT,
    tindakan_guru TEXT,
    tindakan_sekolah TEXT,
    guru TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS pencapaian_records (
    id BIGINT PRIMARY KEY,
    tarikh TEXT,
    nama TEXT,
    no_kad TEXT,
    jenis TEXT,
    keterangan TEXT,
    hadiah TEXT,
    pemberi TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS aktiviti_records (
    id BIGINT PRIMARY KEY,
    tarikh TEXT,
    nama TEXT,
    no_kad TEXT,
    jenis TEXT,
    keterangan TEXT,
    penyertaan TEXT,
    guru TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS pelajar_records (
    id BIGINT PRIMARY KEY,
    nama_penuh TEXT,
    no_kad TEXT,
    ic TEXT,
    tarikh_lahir TEXT,
    jantina TEXT,
    kelas TEXT,
    tarikh_masuk TEXT,
    alamat TEXT,
    nama_wali TEXT,
    telefon_wali TEXT,
    ic_wali TEXT,
    pekerjaan_wali TEXT,
    pendapatan_wali TEXT,
    alamat_wali TEXT,
    wali_kecemasan TEXT,
    telefon_kecemasan TEXT,
    hubungan_kecemasan TEXT,
    status TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    user_id TEXT
);

CREATE TABLE IF NOT EXISTS system_health (
    id SERIAL PRIMARY KEY,
    status TEXT DEFAULT 'healthy',
    last_check TIMESTAMPTZ DEFAULT NOW()
);

-- Insert initial health check record
INSERT INTO system_health (status) VALUES ('healthy') ON CONFLICT DO NOTHING;

-- Enable realtime for all tables
ALTER PUBLICATION supabase_realtime ADD TABLE hafazan_records;
ALTER PUBLICATION supabase_realtime ADD TABLE prestasi_records;
ALTER PUBLICATION supabase_realtime ADD TABLE disiplin_records;
ALTER PUBLICATION supabase_realtime ADD TABLE pencapaian_records;
ALTER PUBLICATION supabase_realtime ADD TABLE aktiviti_records;
ALTER PUBLICATION supabase_realtime ADD TABLE pelajar_records;

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_hafazan_created_at ON hafazan_records(created_at);
CREATE INDEX IF NOT EXISTS idx_prestasi_created_at ON prestasi_records(created_at);
CREATE INDEX IF NOT EXISTS idx_disiplin_created_at ON disiplin_records(created_at);
CREATE INDEX IF NOT EXISTS idx_pencapaian_created_at ON pencapaian_records(created_at);
CREATE INDEX IF NOT EXISTS idx_aktiviti_created_at ON aktiviti_records(created_at);
CREATE INDEX IF NOT EXISTS idx_pelajar_created_at ON pelajar_records(created_at);

-- Create indexes for searching
CREATE INDEX IF NOT EXISTS idx_hafazan_nama ON hafazan_records(nama);
CREATE INDEX IF NOT EXISTS idx_prestasi_nama ON prestasi_records(nama);
CREATE INDEX IF NOT EXISTS idx_disiplin_nama ON disiplin_records(nama);
CREATE INDEX IF NOT EXISTS idx_pelajar_nama ON pelajar_records(nama_penuh);
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-96 overflow-hidden">
                    <div class="flex items-center justify-between p-4 border-b">
                        <h3 class="text-lg font-semibold text-gray-800">SQL Schema untuk Supabase</h3>
                        <button id="close-sql-modal" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="bg-gray-100 p-4 rounded-lg overflow-auto max-h-80">
                            <pre class="text-xs text-gray-800 whitespace-pre-wrap">${sqlSchema}</pre>
                        </div>
                        <div class="flex space-x-2 mt-4">
                            <button id="copy-sql-schema" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200">
                                üìã Salin SQL
                            </button>
                            <button id="download-sql-schema" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition duration-200">
                                üíæ Muat Turun SQL
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('close-sql-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            document.getElementById('copy-sql-schema').addEventListener('click', () => {
                navigator.clipboard.writeText(sqlSchema).then(() => {
                    showNotification('SQL schema berjaya disalin!', 'success');
                });
            });
            
            document.getElementById('download-sql-schema').addEventListener('click', () => {
                const blob = new Blob([sqlSchema], { type: 'text/sql' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'mahad_tahfiz_schema.sql';
                a.click();
                URL.revokeObjectURL(url);
                showNotification('SQL schema berjaya dimuat turun!', 'success');
            });
        }
        
        function updateSupabaseStatus() {
            const indicator = document.getElementById('supabase-status-indicator');
            const statusText = document.getElementById('supabase-status-text');
            const urlDisplay = document.getElementById('current-supabase-url');
            const lastSyncDisplay = document.getElementById('last-sync-time');
            const queueCountDisplay = document.getElementById('sync-queue-count');
            
            if (isOnline) {
                indicator.className = 'w-3 h-3 bg-green-500 rounded-full';
                statusText.textContent = 'Sambungan aktif';
            } else {
                indicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = 'Tiada sambungan';
            }
            
            urlDisplay.textContent = systemSettings.supabaseUrl || SUPABASE_URL;
            lastSyncDisplay.textContent = systemSettings.lastSync ? 
                new Date(systemSettings.lastSync).toLocaleString('ms-MY') : 'Belum pernah';
            queueCountDisplay.textContent = syncQueue.length;
        }
        
        // Update other form handlers to use async/await pattern
        async function handlePrestasiSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const record = {
                id: Date.now(),
                tarikh: formData.get('prestasi-tarikh'),
                hari: formData.get('prestasi-hari'),
                nama: formData.get('prestasi-nama'),
                noKad: formData.get('prestasi-no-kad'),
                surah: formData.get('prestasi-surah'),
                keputusan: formData.get('prestasi-keputusan'),
                catatan: formData.get('prestasi-catatan') || 'Manual entry',
                created_at: new Date().toISOString(),
                user_id: currentUser?.username || 'admin'
            };
            
            prestasiRecords.unshift(record);
            updatePrestasiTable();
            
            // Sync to Supabase
            const syncResult = await syncToSupabase('prestasi_records', record, 'insert');
            if (syncResult.success) {
                showNotification('Rekod prestasi berjaya disimpan dan disegerakkan!', 'success');
            } else if (syncResult.queued) {
                showNotification('Rekod prestasi disimpan. Akan disegerakkan apabila online.', 'warning');
            }
            
            e.target.reset();
            createSystemUpdate('prestasi', 'Rekod Prestasi Baharu', `${record.nama} - ${record.keputusan}`, record);
        }
        
        // Initialize Supabase status on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                updateSupabaseStatus();
                
                // Load saved Supabase settings
                if (systemSettings.supabaseUrl) {
                    document.getElementById('supabase-url-input').value = systemSettings.supabaseUrl;
                }
                if (systemSettings.supabaseKey) {
                    document.getElementById('supabase-key-input').value = systemSettings.supabaseKey;
                }
                document.getElementById('enable-supabase-sync').checked = systemSettings.syncEnabled !== false;
                document.getElementById('enable-realtime-updates').checked = systemSettings.realtimeEnabled !== false;
            }, 1000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'991f9287047186be',t:'MTc2MTAzNzMwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<!-- START: Supabase storage + settings integration (ADDED) -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const SUPABASE_URL = '
  const SUPABASE_KEY = '';
  const BUCKET = 'fail_web';
  const FOLDER = 'tetapan';

  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  function notify(msg, type='info') {
    const container = document.getElementById('notification-container') || document.body;
    const el = document.createElement('div');
    const color = type==='success' ? 'bg-green-500' : type==='error' ? 'bg-red-500' : type==='warning' ? 'bg-yellow-500' : 'bg-blue-500';
    el.className = color + ' text-white px-3 py-2 rounded mb-2';
    el.style.position = 'relative';
    el.textContent = msg;
    if (container === document.body) {
      document.body.appendChild(el);
    } else {
      container.appendChild(el);
    }
    setTimeout(()=> { el.style.opacity=0; setTimeout(()=>el.remove(),300); }, 3500);
  }

  async function uploadToStorage(file, namePrefix) {
    if (!file) return null;
    try {
      const ext = file.name.split('.').pop();
      const ts = Date.now();
      const safe = namePrefix.replace(/[^a-z0-9_\-]/gi,'').toLowerCase();
      const path = `${FOLDER}/${safe}_${ts}.${ext}`;
      const { error: upErr } = await supabase.storage.from(BUCKET).upload(path, file, { upsert: true, contentType: file.type });
      if (upErr) throw upErr;
      const { data } = supabase.storage.from(BUCKET).getPublicUrl(path);
      return data.publicUrl;
    } catch (err) {
      console.error('Upload error', err);
      notify('Gagal muat naik: ' + (err.message || err), 'error');
      return null;
    }
  }

  async function loadSettings() {
    try {
      const { data, error } = await supabase.from('settings').select('*').eq('id', 1).single();
      if (error && error.code !== 'PGRST116') {
        console.error('Load settings err', error);
        notify('Ralat muat tetapan: ' + error.message, 'error');
        return;
      }
      if (data) {
        const nameEl = document.getElementById('namaInstitusiInput');
        if (nameEl) nameEl.value = data.institusi_nama || '';
        const displayEl = document.getElementById('institusiDisplay');
        if (displayEl) displayEl.innerText = data.institusi_nama || '-';
        if (data.logo_url) {
          const logo = document.getElementById('logoDisplay');
          if (logo) { logo.src = data.logo_url; logo.classList.remove('hidden'); }
          const small = document.getElementById('logoDisplaySmall');
          if (small) { small.src = data.logo_url; small.classList.remove('hidden'); }
          const urlDisp = document.getElementById('logoUrlDisplay');
          if (urlDisp) urlDisp.innerText = data.logo_url;
        }
        if (data.wallpaper_url) {
          const wp = document.getElementById('wallpaperDisplay');
          if (wp) { wp.src = data.wallpaper_url; wp.classList.remove('hidden'); }
          const urlDisp = document.getElementById('wallpaperUrlDisplay');
          if (urlDisp) urlDisp.innerText = data.wallpaper_url;
          document.body.style.backgroundImage = `url('${data.wallpaper_url}')`;
        }
      } else {
        console.log('No settings row (id=1)');
      }
    } catch (err) {
      console.error(err);
      notify('Ralat muat tetapan', 'error');
    }
  }

  // Save handler for settings form (uploads files then upsert to settings)
  const saveBtn = document.getElementById('saveButton');
  if (saveBtn) {
    saveBtn.addEventListener('click', async (e) => {
      try {
        saveBtn.disabled = true;
        notify('Memproses simpanan...', 'info');
        const name = document.getElementById('namaInstitusiInput')?.value?.trim() || '';
        const logoFile = document.getElementById('upload-logo-storage')?.files?.[0] || null;
        const wallpaperFile = document.getElementById('upload-wallpaper-storage')?.files?.[0] || null;
        let logoUrl = null;
        let wallpaperUrl = null;
        if (logoFile) {
          logoUrl = await uploadToStorage(logoFile, 'logo');
          if (!logoUrl) { saveBtn.disabled=false; return; }
        }
        if (wallpaperFile) {
          wallpaperUrl = await uploadToStorage(wallpaperFile, 'wallpaper');
          if (!wallpaperUrl) { saveBtn.disabled=false; return; }
        }
        const payload = { id:1, institusi_nama: name };
        if (logoUrl) payload.logo_url = logoUrl;
        if (wallpaperUrl) payload.wallpaper_url = wallpaperUrl;
        const { error: upErr } = await supabase.from('settings').upsert(payload, { onConflict: 'id' });
        if (upErr) {
          console.error('Upsert err', upErr);
          notify('Gagal simpan tetapan: ' + upErr.message, 'error');
        } else {
          notify('Tetapan berjaya disimpan!', 'success');
          await loadSettings();
        }
      } catch (err) {
        console.error('Save err', err);
        notify('Ralat semasa simpan tetapan', 'error');
      } finally {
        saveBtn.disabled = false;
      }
    });
  }

  // Quick preview handlers for original upload inputs
  const logoFileInput = document.getElementById('upload-logo');
  const wallpaperFileInput = document.getElementById('upload-wallpaper');
  const logoPreviewImg = document.getElementById('logo-preview-img');
  const wallpaperPreviewImg = document.getElementById('wallpaper-preview-img');
  const logoStorageInput = document.getElementById('upload-logo-storage');
  const wallpaperStorageInput = document.getElementById('upload-wallpaper-storage');

  if (logoFileInput) {
    logoFileInput.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = (ev) => {
        if (logoPreviewImg) { logoPreviewImg.src = ev.target.result; document.getElementById('logo-preview')?.classList.remove('hidden'); }
      };
      r.readAsDataURL(f);
    });
  }
  if (wallpaperFileInput) {
    wallpaperFileInput.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = (ev) => {
        if (wallpaperPreviewImg) { wallpaperPreviewImg.src = ev.target.result; document.getElementById('wallpaper-preview')?.classList.remove('hidden'); }
      };
      r.readAsDataURL(f);
    });
  }

  // storage inputs preview
  if (logoStorageInput) {
    logoStorageInput.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = (ev) => {
        const img = document.getElementById('logoDisplay');
        if (img) { img.src = ev.target.result; img.classList.remove('hidden'); }
      };
      r.readAsDataURL(f);
    });
  }
  if (wallpaperStorageInput) {
    wallpaperStorageInput.addEventListener('change', (e) => {
      const f = e.target.files?.[0];
      if (!f) return;
      const r = new FileReader();
      r.onload = (ev) => {
        const img = document.getElementById('wallpaperDisplay');
        if (img) { img.src = ev.target.result; img.classList.remove('hidden'); document.body.style.backgroundImage = `url('${ev.target.result}')`; }
      };
      r.readAsDataURL(f);
    });
  }

  // initialize on load
  window.addEventListener('DOMContentLoaded', () => {
    loadSettings();
  });
</script>
<!-- END: Supabase storage + settings integration (ADDED) -->

</body>
</html